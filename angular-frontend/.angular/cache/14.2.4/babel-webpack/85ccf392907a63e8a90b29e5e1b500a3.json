{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/mouji/IdeaProjects/Fitness-store-2022/angular-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ProductInfo } from \"../../../../common/shopping/product-info\";\nimport { CartItem } from \"../../../../common/shopping/cart-item\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../../../services/shared/header-shared.service\";\nimport * as i3 from \"../../../../services/product.service\";\nimport * as i4 from \"../../../../services/prod-details/stock.service\";\nimport * as i5 from \"../../../../services/shopping/cart/cart.service\";\nimport * as i6 from \"../../../../services/authentication/token-storage.service\";\nimport * as i7 from \"../../../../services/shopping/cart/guest-cart.service\";\nimport * as i8 from \"@angular/common\";\n\nfunction ProductPageComponent_span_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r0.productInfo.price.toFixed(2), \" \\u20AC\");\n  }\n}\n\nfunction ProductPageComponent_button_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function ProductPageComponent_button_22_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const size_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.selectSize(size_r3));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const size_r3 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"selected\", ctx_r1.isSelectedSize(size_r3));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(size_r3.size);\n  }\n}\n\nfunction ProductPageComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22)(1, \"h2\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.productInfo.discount.discountName);\n  }\n}\n\nexport class ProductPageComponent {\n  constructor(route, headerService, productService, stockService, cartService, tokenStorageService, guestCartService) {\n    this.route = route;\n    this.headerService = headerService;\n    this.productService = productService;\n    this.stockService = stockService;\n    this.cartService = cartService;\n    this.tokenStorageService = tokenStorageService;\n    this.guestCartService = guestCartService;\n    this.productInfo = new ProductInfo();\n    this.currentProductId = 0;\n    this.isInStock = true;\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.cartItem = new CartItem();\n      _this.cartItem.quantity = 1;\n      yield Promise.all([_this.getProductById(), _this.getAStock()]);\n    })();\n  }\n\n  getAStock() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this2.getProductById();\n\n      if (_this2.productInfo !== null) {\n        _this2.stockService.findStockByProduct(_this2.productInfo.productId).subscribe(data => {\n          if (data.length == 1) {\n            _this2.cartItem.relatedSizeAndStock = data[0];\n          } else {\n            _this2.stocks = data;\n          }\n        });\n      }\n    })();\n  }\n\n  getProductById() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      _this3.currentProductId = +_this3.route.snapshot.paramMap.get('prodId');\n      yield _this3.productService.getProductById(_this3.currentProductId).toPromise().then(data => {\n        if (data != undefined) _this3.productInfo = data;\n      });\n    })();\n  }\n\n  addToCart() {\n    this.cartItem.productInfo = this.productInfo;\n\n    if (this.tokenStorageService.getUser() == undefined) {\n      this.addToCartTwo(this.cartItem);\n    } else {\n      this.cartService.addToCart(this.cartItem).subscribe();\n    }\n\n    this.headerService.reloadHeader();\n  }\n\n  addToCartTwo(cartItem) {\n    const existingCartItem = this.guestCartService.cartItems.find(item => item.productInfo.productId === cartItem.productInfo.productId && item.relatedSizeAndStock.stockId === cartItem.relatedSizeAndStock.stockId);\n\n    if (existingCartItem) {\n      existingCartItem.quantity += cartItem.quantity;\n    } else {\n      this.guestCartService.cartItems.push(cartItem);\n    }\n\n    this.headerService.reloadHeader();\n  }\n\n  selectSize(size) {\n    this.cartItem.relatedSizeAndStock = size;\n  }\n\n  isSelectedSize(size) {\n    return this.cartItem.relatedSizeAndStock === size;\n  }\n\n  isSizeSelected() {\n    return this.cartItem.relatedSizeAndStock !== undefined;\n  }\n\n  changeQty(value) {\n    if (this.cartItem.relatedSizeAndStock == undefined) {\n      this.errorMessage = 'Select a size first';\n      return;\n    } else {\n      const newValue = this.cartItem.quantity + value; // Si la quantité voulue est plus grande que la quantité en stock, mettre le message d'error et ne pas incrément\n\n      if (newValue > this.cartItem.relatedSizeAndStock.itemsInStock) {\n        this.isInStock = false;\n        this.errorMessage = 'We don\\'t have more than this quantity in stock';\n      } else {\n        this.isInStock = true;\n\n        if (newValue >= 1 && newValue <= 10) {\n          this.cartItem.quantity = newValue;\n        } else if (newValue < 1) {\n          this.cartItem.quantity = 1;\n        } else if (newValue > 10) {\n          this.cartItem.quantity = 10;\n        }\n      }\n    }\n  }\n\n  discountedPrice(originalPrice, discountPercentage) {\n    if (discountPercentage) {\n      return originalPrice * (1 - discountPercentage / 100);\n    }\n\n    return originalPrice;\n  }\n\n}\n\nProductPageComponent.ɵfac = function ProductPageComponent_Factory(t) {\n  return new (t || ProductPageComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.HeaderSharedService), i0.ɵɵdirectiveInject(i3.ProductService), i0.ɵɵdirectiveInject(i4.StockService), i0.ɵɵdirectiveInject(i5.CartService), i0.ɵɵdirectiveInject(i6.TokenStorageService), i0.ɵɵdirectiveInject(i7.GuestCartService));\n};\n\nProductPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ProductPageComponent,\n  selectors: [[\"app-product-page\"]],\n  decls: 30,\n  vars: 11,\n  consts: [[1, \"wrapper\"], [1, \"product-page\"], [1, \"details-container\"], [1, \"product-name\"], [1, \"product-price\"], [\"class\", \"original-price\", 4, \"ngIf\"], [1, \"horizontal-line\"], [1, \"product-description\"], [1, \"product-size\"], [1, \"product-buttons\"], [1, \"quantity-buttons\"], [1, \"round-button\", 3, \"click\"], [1, \"round-button\", 3, \"disabled\", \"click\"], [1, \"size-buttons\"], [\"class\", \"product-btn\", 3, \"selected\", \"click\", 4, \"ngFor\", \"ngForOf\"], [2, \"color\", \"red\"], [1, \"add-to-cart-btn\", 3, \"disabled\", \"click\"], [1, \"image-container\"], [1, \"product-image\", 3, \"src\"], [\"class\", \"discount-banner\", 4, \"ngIf\"], [1, \"original-price\"], [1, \"product-btn\", 3, \"click\"], [1, \"discount-banner\"]],\n  template: function ProductPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h1\", 3);\n      i0.ɵɵtext(4);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(5, \"p\", 4);\n      i0.ɵɵtemplate(6, ProductPageComponent_span_6_Template, 2, 1, \"span\", 5);\n      i0.ɵɵtext(7);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(8, \"hr\", 6);\n      i0.ɵɵelementStart(9, \"p\", 7);\n      i0.ɵɵtext(10);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(11, \"p\", 8);\n      i0.ɵɵtext(12, \"size\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(13, \"div\", 9)(14, \"div\", 10)(15, \"button\", 11);\n      i0.ɵɵlistener(\"click\", function ProductPageComponent_Template_button_click_15_listener() {\n        return ctx.changeQty(-1);\n      });\n      i0.ɵɵtext(16, \"-\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(17, \"p\");\n      i0.ɵɵtext(18);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(19, \"button\", 12);\n      i0.ɵɵlistener(\"click\", function ProductPageComponent_Template_button_click_19_listener() {\n        return ctx.changeQty(1);\n      });\n      i0.ɵɵtext(20, \"+\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(21, \"div\", 13);\n      i0.ɵɵtemplate(22, ProductPageComponent_button_22_Template, 2, 3, \"button\", 14);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(23, \"p\", 15);\n      i0.ɵɵtext(24);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(25, \"button\", 16);\n      i0.ɵɵlistener(\"click\", function ProductPageComponent_Template_button_click_25_listener() {\n        return ctx.addToCart();\n      });\n      i0.ɵɵtext(26, \"Add to cart\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(27, \"div\", 17);\n      i0.ɵɵelement(28, \"img\", 18);\n      i0.ɵɵtemplate(29, ProductPageComponent_div_29_Template, 3, 1, \"div\", 19);\n      i0.ɵɵelementEnd()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵtextInterpolate(ctx.productInfo.name);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.productInfo.discount);\n      i0.ɵɵadvance(1);\n      i0.ɵɵtextInterpolate1(\" \", ctx.discountedPrice(ctx.productInfo.price, ctx.productInfo.discount ? ctx.productInfo.discount.percentage : undefined).toFixed(2), \" \\u20AC \");\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate(ctx.productInfo.description);\n      i0.ɵɵadvance(8);\n      i0.ɵɵtextInterpolate(ctx.cartItem.quantity);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"disabled\", !ctx.isInStock);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngForOf\", ctx.stocks);\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate(ctx.errorMessage);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"disabled\", !ctx.isSizeSelected());\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"src\", ctx.productInfo.imageURL, i0.ɵɵsanitizeUrl);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.productInfo.discount);\n    }\n  },\n  dependencies: [i8.NgForOf, i8.NgIf],\n  styles: [\".product-page[_ngcontent-%COMP%] {\\n  display: flex;\\n  padding: 20px 30px;\\n  justify-content: space-around;\\n}\\n\\n.details-container[_ngcontent-%COMP%] {\\n  width: 60%;\\n  text-align: center;\\n}\\n\\n.product-name[_ngcontent-%COMP%] {\\n  text-transform: uppercase;\\n  padding: 20px 0;\\n  font-size: 40px;\\n}\\n\\n.product-price[_ngcontent-%COMP%] {\\n  font-size: 25px;\\n  color: red;\\n  padding: 30px 0;\\n}\\n\\n.original-price[_ngcontent-%COMP%] {\\n  text-decoration: line-through;\\n  color: #aaa;\\n  margin-right: 5px;\\n}\\n\\n.horizontal-line[_ngcontent-%COMP%] {\\n  border-top: 2px solid black;\\n  width: 70%;\\n  margin: auto;\\n}\\n\\n.product-size[_ngcontent-%COMP%] {\\n  padding-top: 30px;\\n}\\n\\n.quantity-buttons[_ngcontent-%COMP%] {\\n  display: flex;\\n  justify-content: center;\\n}\\n\\n.product-buttons[_ngcontent-%COMP%] {\\n  padding: 27px 0;\\n}\\n\\n.size-buttons[_ngcontent-%COMP%] {\\n  color: yellow;\\n}\\n\\n.product-btn[_ngcontent-%COMP%]:link, .product-btn[_ngcontent-%COMP%]:visited {\\n  outline: none;\\n  text-decoration: none;\\n  padding: 10px 10px;\\n  background-color: white;\\n  border: solid 1.2px black;\\n  cursor: pointer;\\n}\\n\\n.add-to-cart-btn[_ngcontent-%COMP%] {\\n  transform: skew(-15deg);\\n  font-size: 14px;\\n  text-transform: uppercase;\\n  letter-spacing: 2px;\\n  border: none;\\n  outline: none;\\n  background-color: #b50000;\\n  color: white;\\n  font-weight: 600;\\n  width: 80%;\\n  padding: 20px 20px;\\n  margin-top: 20px;\\n}\\n\\n.add-to-cart-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%] {\\n  display: inline-block;\\n  transform: skew(15deg);\\n}\\n\\n.add-to-cart-btn[_ngcontent-%COMP%]:active {\\n  background-color: #980000;\\n}\\n\\n.product-description[_ngcontent-%COMP%] {\\n  width: 85%;\\n  margin: auto;\\n  text-align: center;\\n  padding-top: 30px;\\n  font-size: 17px;\\n}\\n\\n.image-container[_ngcontent-%COMP%] {\\n  margin-top: 50px;\\n  flex: 0 0 45%;\\n  overflow: hidden;\\n  position: relative;\\n}\\n\\n.product-image[_ngcontent-%COMP%] {\\n  display: table-cell;\\n  text-align: center;\\n  height: 100%;\\n  margin: auto;\\n  max-width: 100%;\\n  max-height: 100%;\\n}\\n\\n.discount-banner[_ngcontent-%COMP%] {\\n  position: absolute;\\n  top: 13%;\\n  left: 0;\\n  background-color: red;\\n  color: white;\\n  padding: 5px 20px;\\n  font-size: 16px;\\n  font-weight: bold;\\n  z-index: 1;\\n  transform: rotate(-45deg);\\n  transform-origin: 0 0;\\n  text-align: center;\\n  width: 200px;\\n}\\n\\n.selected[_ngcontent-%COMP%] {\\n  background-color: white;\\n  color: black;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2R1Y3QtcGFnZS5jb21wb25lbnQuc2FzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGFBQUE7RUFDQSxrQkFBQTtFQUNBLDZCQUFBO0FBQ0Y7O0FBQ0E7RUFDRSxVQUFBO0VBQ0Esa0JBQUE7QUFFRjs7QUFBQTtFQUNFLHlCQUFBO0VBQ0EsZUFBQTtFQUNBLGVBQUE7QUFHRjs7QUFEQTtFQUNFLGVBQUE7RUFDQSxVQUFBO0VBQ0EsZUFBQTtBQUlGOztBQUZBO0VBQ0UsNkJBQUE7RUFDQSxXQUFBO0VBQ0EsaUJBQUE7QUFLRjs7QUFIQTtFQUNFLDJCQUFBO0VBQ0EsVUFBQTtFQUNBLFlBQUE7QUFNRjs7QUFKQTtFQUNFLGlCQUFBO0FBT0Y7O0FBTEE7RUFDRSxhQUFBO0VBQ0EsdUJBQUE7QUFRRjs7QUFOQTtFQUNFLGVBQUE7QUFTRjs7QUFQQTtFQUNFLGFBQUE7QUFVRjs7QUFQRTtFQUVFLGFBQUE7RUFDQSxxQkFBQTtFQUNBLGtCQUFBO0VBQ0EsdUJBQUE7RUFDQSx5QkFBQTtFQUNBLGVBQUE7QUFTSjs7QUFQQTtFQUNFLHVCQUFBO0VBQ0EsZUFBQTtFQUNBLHlCQUFBO0VBQ0EsbUJBQUE7RUFDQSxZQUFBO0VBQ0EsYUFBQTtFQUNBLHlCQUFBO0VBQ0EsWUFBQTtFQUNBLGdCQUFBO0VBQ0EsVUFBQTtFQUNBLGtCQUFBO0VBQ0EsZ0JBQUE7QUFVRjs7QUFSRTtFQUNFLHFCQUFBO0VBQ0Esc0JBQUE7QUFVSjs7QUFSRTtFQUNFLHlCQUFBO0FBVUo7O0FBUkE7RUFDRSxVQUFBO0VBQ0EsWUFBQTtFQUNBLGtCQUFBO0VBQ0EsaUJBQUE7RUFDQSxlQUFBO0FBV0Y7O0FBVEE7RUFDRSxnQkFBQTtFQUNBLGFBQUE7RUFDQSxnQkFBQTtFQUNBLGtCQUFBO0FBWUY7O0FBVkE7RUFDRSxtQkFBQTtFQUNBLGtCQUFBO0VBQ0EsWUFBQTtFQUNBLFlBQUE7RUFDQSxlQUFBO0VBQ0EsZ0JBQUE7QUFhRjs7QUFYQTtFQUNFLGtCQUFBO0VBQ0EsUUFBQTtFQUNBLE9BQUE7RUFDQSxxQkFBQTtFQUNBLFlBQUE7RUFDQSxpQkFBQTtFQUNBLGVBQUE7RUFDQSxpQkFBQTtFQUNBLFVBQUE7RUFDQSx5QkFBQTtFQUNBLHFCQUFBO0VBQ0Esa0JBQUE7RUFDQSxZQUFBO0FBY0Y7O0FBWkE7RUFDRSx1QkFBQTtFQUNBLFlBQUE7QUFlRiIsImZpbGUiOiJwcm9kdWN0LXBhZ2UuY29tcG9uZW50LnNhc3MiLCJzb3VyY2VzQ29udGVudCI6WyIucHJvZHVjdC1wYWdlXHJcbiAgZGlzcGxheTogZmxleFxyXG4gIHBhZGRpbmc6IDIwcHggMzBweFxyXG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYXJvdW5kXHJcblxyXG4uZGV0YWlscy1jb250YWluZXJcclxuICB3aWR0aDogNjAlXHJcbiAgdGV4dC1hbGlnbjogY2VudGVyXHJcblxyXG4ucHJvZHVjdC1uYW1lXHJcbiAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZVxyXG4gIHBhZGRpbmc6IDIwcHggMFxyXG4gIGZvbnQtc2l6ZTogNDBweFxyXG5cclxuLnByb2R1Y3QtcHJpY2VcclxuICBmb250LXNpemU6IDI1cHhcclxuICBjb2xvcjogcmVkXHJcbiAgcGFkZGluZzogMzBweCAwXHJcblxyXG4ub3JpZ2luYWwtcHJpY2VcclxuICB0ZXh0LWRlY29yYXRpb246IGxpbmUtdGhyb3VnaFxyXG4gIGNvbG9yOiAjYWFhXHJcbiAgbWFyZ2luLXJpZ2h0OiA1cHhcclxuXHJcbi5ob3Jpem9udGFsLWxpbmVcclxuICBib3JkZXItdG9wOiAycHggc29saWQgYmxhY2tcclxuICB3aWR0aDogNzAlXHJcbiAgbWFyZ2luOiBhdXRvXHJcblxyXG4ucHJvZHVjdC1zaXplXHJcbiAgcGFkZGluZy10b3A6IDMwcHhcclxuXHJcbi5xdWFudGl0eS1idXR0b25zXHJcbiAgZGlzcGxheTogZmxleFxyXG4gIGp1c3RpZnktY29udGVudDogY2VudGVyXHJcblxyXG4ucHJvZHVjdC1idXR0b25zXHJcbiAgcGFkZGluZzogMjdweCAwXHJcblxyXG4uc2l6ZS1idXR0b25zXHJcbiAgY29sb3I6IHllbGxvd1xyXG5cclxuLnByb2R1Y3QtYnRuXHJcbiAgJjpsaW5rLFxyXG4gICY6dmlzaXRlZFxyXG4gICAgb3V0bGluZTogbm9uZVxyXG4gICAgdGV4dC1kZWNvcmF0aW9uOiBub25lXHJcbiAgICBwYWRkaW5nOiAxMHB4IDEwcHhcclxuICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlXHJcbiAgICBib3JkZXI6IHNvbGlkIDEuMnB4IGJsYWNrXHJcbiAgICBjdXJzb3I6IHBvaW50ZXJcclxuXHJcbi5hZGQtdG8tY2FydC1idG5cclxuICB0cmFuc2Zvcm06IHNrZXcoLTE1ZGVnKVxyXG4gIGZvbnQtc2l6ZTogMTRweFxyXG4gIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2VcclxuICBsZXR0ZXItc3BhY2luZzogMnB4XHJcbiAgYm9yZGVyOiBub25lXHJcbiAgb3V0bGluZTogbm9uZVxyXG4gIGJhY2tncm91bmQtY29sb3I6ICNiNTAwMDBcclxuICBjb2xvcjogd2hpdGVcclxuICBmb250LXdlaWdodDogNjAwXHJcbiAgd2lkdGg6IDgwJVxyXG4gIHBhZGRpbmc6IDIwcHggMjBweFxyXG4gIG1hcmdpbi10b3A6IDIwcHhcclxuXHJcbiAgc3BhblxyXG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrXHJcbiAgICB0cmFuc2Zvcm06IHNrZXcoMTVkZWcpXHJcblxyXG4gICY6YWN0aXZlXHJcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjOTgwMDAwXHJcblxyXG4ucHJvZHVjdC1kZXNjcmlwdGlvblxyXG4gIHdpZHRoOiA4NSVcclxuICBtYXJnaW46IGF1dG9cclxuICB0ZXh0LWFsaWduOiBjZW50ZXJcclxuICBwYWRkaW5nLXRvcDogMzBweFxyXG4gIGZvbnQtc2l6ZTogMTdweFxyXG5cclxuLmltYWdlLWNvbnRhaW5lclxyXG4gIG1hcmdpbi10b3A6IDUwcHhcclxuICBmbGV4OiAwIDAgNDUlXHJcbiAgb3ZlcmZsb3c6IGhpZGRlblxyXG4gIHBvc2l0aW9uOiByZWxhdGl2ZVxyXG5cclxuLnByb2R1Y3QtaW1hZ2VcclxuICBkaXNwbGF5OiB0YWJsZS1jZWxsXHJcbiAgdGV4dC1hbGlnbjogY2VudGVyXHJcbiAgaGVpZ2h0OiAxMDAlXHJcbiAgbWFyZ2luOiBhdXRvXHJcbiAgbWF4LXdpZHRoOiAxMDAlXHJcbiAgbWF4LWhlaWdodDogMTAwJVxyXG5cclxuLmRpc2NvdW50LWJhbm5lclxyXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZVxyXG4gIHRvcDogMTMlXHJcbiAgbGVmdDogMFxyXG4gIGJhY2tncm91bmQtY29sb3I6IHJlZFxyXG4gIGNvbG9yOiB3aGl0ZVxyXG4gIHBhZGRpbmc6IDVweCAyMHB4XHJcbiAgZm9udC1zaXplOiAxNnB4XHJcbiAgZm9udC13ZWlnaHQ6IGJvbGRcclxuICB6LWluZGV4OiAxXHJcbiAgdHJhbnNmb3JtOiByb3RhdGUoLTQ1ZGVnKVxyXG4gIHRyYW5zZm9ybS1vcmlnaW46IDAgMFxyXG4gIHRleHQtYWxpZ246IGNlbnRlclxyXG4gIHdpZHRoOiAyMDBweFxyXG5cclxuLnNlbGVjdGVkXHJcbiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGVcclxuICBjb2xvcjogYmxhY2tcclxuIl19 */\"]\n});","map":{"version":3,"mappings":"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","names":["ProductInfo","CartItem","i0","ProductPageComponent","constructor","route","headerService","productService","stockService","cartService","tokenStorageService","guestCartService","ngOnInit","cartItem","quantity","Promise","all","getProductById","getAStock","productInfo","findStockByProduct","productId","subscribe","data","length","relatedSizeAndStock","stocks","currentProductId","snapshot","paramMap","get","toPromise","then","undefined","addToCart","getUser","addToCartTwo","reloadHeader","existingCartItem","cartItems","find","item","stockId","push","selectSize","size","isSelectedSize","isSizeSelected","changeQty","value","errorMessage","newValue","itemsInStock","isInStock","discountedPrice","originalPrice","discountPercentage","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\mouji\\IdeaProjects\\Fitness-store-2022\\angular-frontend\\src\\app\\components\\shopping\\showcase\\product-page\\product-page.component.ts","C:\\Users\\mouji\\IdeaProjects\\Fitness-store-2022\\angular-frontend\\src\\app\\components\\shopping\\showcase\\product-page\\product-page.component.html"],"sourcesContent":["import {Component, OnInit} from '@angular/core';\nimport {ProductInfo} from \"../../../../common/shopping/product-info\";\nimport {ProductService} from \"../../../../services/product.service\";\nimport {ActivatedRoute} from \"@angular/router\";\nimport {CartItem} from \"../../../../common/shopping/cart-item\";\nimport {CartService} from \"../../../../services/shopping/cart/cart.service\";\nimport {Stock} from \"../../../../common/prod-details/stock\";\nimport {StockService} from \"../../../../services/prod-details/stock.service\";\nimport {UserService} from \"../../../../services/authentication/user.service\";\nimport {TokenStorageService} from \"../../../../services/authentication/token-storage.service\";\nimport {GuestCartService} from \"../../../../services/shopping/cart/guest-cart.service\";\nimport {HeaderSharedService} from \"../../../../services/shared/header-shared.service\";\n\n@Component({\n  selector: 'app-product-page',\n  templateUrl: './product-page.component.html',\n  styleUrls: ['./product-page.component.sass']\n})\nexport class ProductPageComponent implements OnInit {\n\n  productInfo: ProductInfo = new ProductInfo();\n  cartItem!: CartItem;\n  currentProductId: number = 0;\n  stocks!: Stock[];\n  isInStock: boolean = true;\n  errorMessage!: string;\n\n\n  constructor(private route: ActivatedRoute,\n              private headerService: HeaderSharedService,\n              private productService: ProductService,\n              private stockService: StockService,\n              private cartService: CartService,\n              private tokenStorageService: TokenStorageService,\n              private guestCartService: GuestCartService) {\n  }\n\n  async ngOnInit() {\n    this.cartItem = new CartItem();\n    this.cartItem.quantity = 1;\n    await Promise.all([this.getProductById(), this.getAStock()]);\n  }\n\n  async getAStock() {\n    await this.getProductById();\n\n    if (this.productInfo !== null) {\n      this.stockService.findStockByProduct(this.productInfo.productId).subscribe(data => {\n        if (data.length == 1) {\n          this.cartItem.relatedSizeAndStock = data[0];\n        } else {\n          this.stocks = data;\n        }\n      })\n    }\n  }\n\n  async getProductById() {\n    this.currentProductId = +this.route.snapshot.paramMap.get('prodId')!;\n\n    await this.productService.getProductById(this.currentProductId).toPromise().then(\n      data => {\n        if (data != undefined)\n          this.productInfo = data;\n      }\n    );\n  }\n\n\n  addToCart() {\n    this.cartItem.productInfo = this.productInfo;\n    if (this.tokenStorageService.getUser() == undefined) {\n      this.addToCartTwo(this.cartItem);\n    } else {\n      this.cartService.addToCart(this.cartItem).subscribe()\n    }\n    this.headerService.reloadHeader();\n  }\n\n  addToCartTwo(cartItem: CartItem) {\n    const existingCartItem = this.guestCartService.cartItems.find(item =>\n      item.productInfo.productId === cartItem.productInfo.productId && item.relatedSizeAndStock.stockId === cartItem.relatedSizeAndStock.stockId\n    );\n\n    if (existingCartItem) {\n      existingCartItem.quantity += cartItem.quantity;\n    } else {\n      this.guestCartService.cartItems.push(cartItem);\n    }\n    this.headerService.reloadHeader();\n  }\n\n  selectSize(size: any) {\n    this.cartItem.relatedSizeAndStock = size;\n  }\n\n  isSelectedSize(size: Stock): boolean {\n    return this.cartItem.relatedSizeAndStock === size;\n  }\n\n  isSizeSelected(): boolean {\n    return this.cartItem.relatedSizeAndStock !== undefined;\n  }\n\n  changeQty(value: number) {\n    if (this.cartItem.relatedSizeAndStock == undefined) {\n      this.errorMessage = 'Select a size first'\n      return;\n    } else {\n      const newValue = this.cartItem.quantity + value;\n      // Si la quantité voulue est plus grande que la quantité en stock, mettre le message d'error et ne pas incrément\n      if (newValue > this.cartItem.relatedSizeAndStock.itemsInStock) {\n        this.isInStock = false;\n        this.errorMessage = 'We don\\'t have more than this quantity in stock';\n      } else {\n        this.isInStock = true;\n        if (newValue >= 1 && newValue <= 10) {\n          this.cartItem.quantity = newValue;\n        } else if (newValue < 1) {\n          this.cartItem.quantity = 1;\n        } else if (newValue > 10) {\n          this.cartItem.quantity = 10;\n        }\n      }\n    }\n  }\n  discountedPrice(originalPrice: number, discountPercentage?: number): number {\n    if (discountPercentage) {\n      return originalPrice * (1 - discountPercentage / 100);\n    }\n    return originalPrice;\n  }\n}\n","<div class=\"wrapper\">\n  <div class=\"product-page\">\n    <div class=\"details-container\">\n      <h1 class=\"product-name\">{{productInfo.name}}</h1>\n      <p class=\"product-price\">\n        <span *ngIf=\"productInfo.discount\" class=\"original-price\">{{productInfo.price.toFixed(2)}} €</span>\n        {{ discountedPrice(productInfo.price, productInfo.discount ? productInfo.discount.percentage : undefined).toFixed(2) }} €\n      </p>\n      <hr class=\"horizontal-line\">\n      <p class=\"product-description\">{{productInfo.description}}</p>\n      <p class=\"product-size\">size</p>\n      <div class=\"product-buttons\">\n        <div class=\"quantity-buttons\">\n          <button class=\"round-button\" (click)=\"changeQty(-1)\">-</button>\n          <p>{{cartItem.quantity}}</p>\n          <button class=\"round-button\" (click)=\"changeQty(1)\" [disabled]=\"!isInStock\">+</button>\n        </div>\n        <div class=\"size-buttons\">\n          <button *ngFor=\"let size of stocks\" (click)=\"selectSize(size)\" [class.selected]=\"isSelectedSize(size)\"\n                  class=\"product-btn\">{{size.size}}</button>\n        </div>\n      </div>\n      <p style=\"color: red\">{{errorMessage}}</p>\n      <button class=\"add-to-cart-btn\" (click)=\"addToCart()\" [disabled]=\"!isSizeSelected()\">Add to cart</button>\n    </div>\n    <div class=\"image-container\">\n      <img [src]=\"productInfo.imageURL\" class=\"product-image\">\n      <div *ngIf=\"productInfo.discount\" class=\"discount-banner\"><h2>{{ productInfo.discount.discountName }}</h2></div>\n    </div>\n  </div>\n</div>\n"]},"metadata":{},"sourceType":"module"}