{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/mouji/IdeaProjects/Fitness-store-2022/angular-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { OrderInfo } from \"../../../common/users/orderInfo\";\nimport { Cart } from \"../../../common/shopping/cart\";\nimport { ShippingAddress } from \"../../../common/users/shipping-address\";\nimport { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../services/shopping/order/order.service\";\nimport * as i2 from \"../../../services/shopping/cart/cart.service\";\nimport * as i3 from \"../../../services/authentication/token-storage.service\";\nimport * as i4 from \"../../../services/shopping/payment-method/payment-method.service\";\n\nfunction CheckoutPageComponent_tr_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\")(6, \"span\", 18);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const cartItem_r6 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(cartItem_r6.productInfo.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(cartItem_r6.relatedSizeAndStock.size);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(cartItem_r6.quantity);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", cartItem_r6.totalPrice, \" \\u20AC\");\n  }\n}\n\nfunction CheckoutPageComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"p\", 20);\n    i0.ɵɵtext(2, \"Street and number is required.\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction CheckoutPageComponent_div_32_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"p\", 20);\n    i0.ɵɵtext(2, \"City is required.\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction CheckoutPageComponent_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"p\", 20);\n    i0.ɵɵtext(2, \"Country is required.\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction CheckoutPageComponent_option_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const paymentMethod_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", paymentMethod_r7);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(paymentMethod_r7.name);\n  }\n}\n\nfunction CheckoutPageComponent_div_43_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"p\", 20);\n    i0.ɵɵtext(2, \"Payment Method is required.\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nexport class CheckoutPageComponent {\n  constructor(orderService, cartService, tokenStorageService, paymentMethodService) {\n    this.orderService = orderService;\n    this.cartService = cartService;\n    this.tokenStorageService = tokenStorageService;\n    this.paymentMethodService = paymentMethodService;\n    this.checkoutForm = new FormGroup({\n      street: new FormControl('', Validators.required),\n      city: new FormControl(0, Validators.required),\n      country: new FormControl('unisex', Validators.required),\n      paymentMethod: new FormControl('', Validators.required)\n    });\n    this.cart = new Cart();\n    this.orderInfo = new OrderInfo();\n    this.cartItems = [];\n    this.paymentMethods = [];\n    this.shippingAddress = new ShippingAddress();\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      //TODO: Transfer this cause it's duplicated code\n      _this.retrievePaymentMethods();\n\n      yield Promise.all([_this.retrieveUserCart(), _this.retrieveCartItems()]);\n\n      _this.updateCartTotal();\n    })();\n  }\n\n  retrieveCartItems() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this2.retrieveUserCart();\n\n      _this2.cartService.retrieveCartItems(_this2.cart.cartId).subscribe(data => {\n        _this2.cartItems = data;\n\n        _this2.updateCartTotal();\n      }, error => {\n        console.log(error);\n      });\n    })();\n  }\n\n  retrieveUserCart() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this3.cartService.retrieveCart().toPromise().then(data => {\n        if (data != undefined) _this3.cart = data;\n      }, error => {\n        console.log(error);\n      });\n    })();\n  }\n\n  retrievePaymentMethods() {\n    this.paymentMethodService.getAllPaymentMethods().subscribe(data => {\n      this.paymentMethods = data;\n    }, error => {\n      console.log(error);\n    });\n  }\n\n  validateCheckout() {\n    this.orderService.processCheckout(this.orderInfo, this.cartItems, this.tokenStorageService.getUser().username, this.shippingAddress).subscribe(data => {\n      console.log(data);\n    }, error => {\n      console.log(error);\n    });\n  }\n\n  updateCartTotal() {\n    this.cart.totalPrice = this.cartItems.reduce((total, cartItem) => total + cartItem.totalPrice, 0);\n  }\n\n  get street() {\n    return this.checkoutForm.get('street');\n  }\n\n  get city() {\n    return this.checkoutForm.get('city');\n  }\n\n  get country() {\n    return this.checkoutForm.get('country');\n  }\n\n  get paymentMethod() {\n    return this.checkoutForm.get('paymentMethod');\n  }\n\n}\n\nCheckoutPageComponent.ɵfac = function CheckoutPageComponent_Factory(t) {\n  return new (t || CheckoutPageComponent)(i0.ɵɵdirectiveInject(i1.OrderService), i0.ɵɵdirectiveInject(i2.CartService), i0.ɵɵdirectiveInject(i3.TokenStorageService), i0.ɵɵdirectiveInject(i4.PaymentMethodService));\n};\n\nCheckoutPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CheckoutPageComponent,\n  selectors: [[\"app-checkout-page\"]],\n  decls: 46,\n  vars: 12,\n  consts: [[1, \"checkout-page\"], [1, \"cart-section\"], [1, \"cart-table\"], [4, \"ngFor\", \"ngForOf\"], [1, \"user-section\"], [1, \"user-form\", 3, \"formGroup\", \"ngSubmit\"], [1, \"form-group\"], [\"for\", \"street\"], [\"type\", \"text\", \"id\", \"street\", \"name\", \"street\", \"formControlName\", \"street\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"class\", \"error-message\", 4, \"ngIf\"], [\"for\", \"city\"], [\"type\", \"text\", \"id\", \"city\", \"name\", \"city\", \"formControlName\", \"city\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"country\"], [\"type\", \"text\", \"id\", \"country\", \"name\", \"country\", \"formControlName\", \"country\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"paymentMethod\", \"id\", \"paymentMethod\", \"formControlName\", \"paymentMethod\", 3, \"ngModel\", \"ngModelChange\"], [\"selected\", \"\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"checkout-button\"], [1, \"quantity\"], [1, \"error-message\"], [2, \"color\", \"red\"], [3, \"ngValue\"]],\n  template: function CheckoutPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\");\n      i0.ɵɵtext(3, \"Validation de commande\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(4, \"table\", 2)(5, \"thead\")(6, \"tr\")(7, \"th\");\n      i0.ɵɵtext(8, \"Produit\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(9, \"th\");\n      i0.ɵɵtext(10, \"Size\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(11, \"th\");\n      i0.ɵɵtext(12, \"Quantit\\u00E9\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(13, \"th\");\n      i0.ɵɵtext(14, \"Prix total\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(15, \"tbody\");\n      i0.ɵɵtemplate(16, CheckoutPageComponent_tr_16_Template, 10, 4, \"tr\", 3);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(17, \"h2\");\n      i0.ɵɵtext(18);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(19, \"div\", 4)(20, \"h2\");\n      i0.ɵɵtext(21, \"Informations personnelles\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(22, \"form\", 5);\n      i0.ɵɵlistener(\"ngSubmit\", function CheckoutPageComponent_Template_form_ngSubmit_22_listener() {\n        return ctx.validateCheckout();\n      });\n      i0.ɵɵelementStart(23, \"div\", 6)(24, \"label\", 7);\n      i0.ɵɵtext(25, \"Street :\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(26, \"input\", 8);\n      i0.ɵɵlistener(\"ngModelChange\", function CheckoutPageComponent_Template_input_ngModelChange_26_listener($event) {\n        return ctx.shippingAddress.streetNameAndNumber = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(27, CheckoutPageComponent_div_27_Template, 3, 0, \"div\", 9);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(28, \"div\", 6)(29, \"label\", 10);\n      i0.ɵɵtext(30, \"City:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(31, \"input\", 11);\n      i0.ɵɵlistener(\"ngModelChange\", function CheckoutPageComponent_Template_input_ngModelChange_31_listener($event) {\n        return ctx.shippingAddress.city = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(32, CheckoutPageComponent_div_32_Template, 3, 0, \"div\", 9);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(33, \"div\", 6)(34, \"label\", 12);\n      i0.ɵɵtext(35, \"Country:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(36, \"input\", 13);\n      i0.ɵɵlistener(\"ngModelChange\", function CheckoutPageComponent_Template_input_ngModelChange_36_listener($event) {\n        return ctx.shippingAddress.country = $event;\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(37, CheckoutPageComponent_div_37_Template, 3, 0, \"div\", 9);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(38, \"div\", 6)(39, \"select\", 14);\n      i0.ɵɵlistener(\"ngModelChange\", function CheckoutPageComponent_Template_select_ngModelChange_39_listener($event) {\n        return ctx.orderInfo.paymentMethod = $event;\n      });\n      i0.ɵɵelementStart(40, \"option\", 15);\n      i0.ɵɵtext(41, \"Select a payment method\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(42, CheckoutPageComponent_option_42_Template, 2, 2, \"option\", 16);\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(43, CheckoutPageComponent_div_43_Template, 3, 0, \"div\", 9);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(44, \"button\", 17);\n      i0.ɵɵtext(45, \"Valider la commande\");\n      i0.ɵɵelementEnd()()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(16);\n      i0.ɵɵproperty(\"ngForOf\", ctx.cartItems);\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate1(\"Total: \", ctx.cart.totalPrice, \" \\u20AC\");\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"formGroup\", ctx.checkoutForm);\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngModel\", ctx.shippingAddress.streetNameAndNumber);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", (ctx.street == null ? null : ctx.street.touched) && (ctx.street == null ? null : ctx.street.invalid));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngModel\", ctx.shippingAddress.city);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", (ctx.city == null ? null : ctx.city.touched) && (ctx.city == null ? null : ctx.city.invalid));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"ngModel\", ctx.shippingAddress.country);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", (ctx.country == null ? null : ctx.country.touched) && (ctx.country == null ? null : ctx.country.invalid));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngModel\", ctx.orderInfo.paymentMethod);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngForOf\", ctx.paymentMethods);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", (ctx.paymentMethod == null ? null : ctx.paymentMethod.touched) && (ctx.paymentMethod == null ? null : ctx.paymentMethod.invalid));\n    }\n  },\n  styles: [\".checkout-page[_ngcontent-%COMP%] {\\n  display: flex;\\n  align-items: flex-start;\\n  justify-content: space-between;\\n  background-color: #f5f5f5;\\n  padding: 20px;\\n}\\n\\n.cart-section[_ngcontent-%COMP%] {\\n  width: 30%;\\n  padding-right: 10px;\\n}\\n\\n.user-section[_ngcontent-%COMP%] {\\n  width: 50%;\\n  padding-left: 10px;\\n}\\n\\n.cart-table[_ngcontent-%COMP%] {\\n  width: 100%;\\n  border-collapse: collapse;\\n  margin-bottom: 20px;\\n}\\n\\n.cart-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\\n  background-color: #333;\\n  color: #fff;\\n  padding: 10px;\\n  text-align: left;\\n}\\n\\n.cart-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\\n  padding: 10px;\\n  border-bottom: 1px solid #ccc;\\n}\\n\\nh1[_ngcontent-%COMP%] {\\n  color: #333;\\n  font-size: 24px;\\n  margin-bottom: 20px;\\n}\\n\\nh2[_ngcontent-%COMP%] {\\n  color: #333;\\n  font-size: 20px;\\n  margin-bottom: 20px;\\n}\\n\\n.user-form[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.form-group[_ngcontent-%COMP%] {\\n  margin-bottom: 10px;\\n}\\n\\nlabel[_ngcontent-%COMP%] {\\n  font-weight: bold;\\n}\\n\\ninput[type=text][_ngcontent-%COMP%], input[type=email][_ngcontent-%COMP%], input[type=tel][_ngcontent-%COMP%] {\\n  width: 100%;\\n  padding: 8px 12px;\\n  border: 1px solid #ccc;\\n  border-radius: 4px;\\n  margin-top: 4px;\\n  font-size: 14px;\\n  box-sizing: border-box;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNrb3V0LXBhZ2UuY29tcG9uZW50LnNhc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxhQUFBO0VBQ0EsdUJBQUE7RUFDQSw4QkFBQTtFQUNBLHlCQUFBO0VBQ0EsYUFBQTtBQUNGOztBQUNBO0VBQ0UsVUFBQTtFQUNBLG1CQUFBO0FBRUY7O0FBQUE7RUFDRSxVQUFBO0VBQ0Esa0JBQUE7QUFHRjs7QUFEQTtFQUNFLFdBQUE7RUFDQSx5QkFBQTtFQUNBLG1CQUFBO0FBSUY7O0FBRkE7RUFDRSxzQkFBQTtFQUNBLFdBQUE7RUFDQSxhQUFBO0VBQ0EsZ0JBQUE7QUFLRjs7QUFIQTtFQUNFLGFBQUE7RUFDQSw2QkFBQTtBQU1GOztBQUhBO0VBQ0UsV0FBQTtFQUNBLGVBQUE7RUFDQSxtQkFBQTtBQU1GOztBQUpBO0VBQ0UsV0FBQTtFQUNBLGVBQUE7RUFDQSxtQkFBQTtBQU9GOztBQUxBO0VBQ0UsYUFBQTtFQUNBLHNCQUFBO0FBUUY7O0FBTkE7RUFDRSxtQkFBQTtBQVNGOztBQVBBO0VBQ0UsaUJBQUE7QUFVRjs7QUFSQTs7O0VBR0UsV0FBQTtFQUNBLGlCQUFBO0VBQ0Esc0JBQUE7RUFDQSxrQkFBQTtFQUNBLGVBQUE7RUFDQSxlQUFBO0VBQ0Esc0JBQUE7QUFXRiIsImZpbGUiOiJjaGVja291dC1wYWdlLmNvbXBvbmVudC5zYXNzIiwic291cmNlc0NvbnRlbnQiOlsiLmNoZWNrb3V0LXBhZ2VcclxuICBkaXNwbGF5OiBmbGV4XHJcbiAgYWxpZ24taXRlbXM6IGZsZXgtc3RhcnRcclxuICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW5cclxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNWY1XHJcbiAgcGFkZGluZzogMjBweFxyXG5cclxuLmNhcnQtc2VjdGlvblxyXG4gIHdpZHRoOiAzMCVcclxuICBwYWRkaW5nLXJpZ2h0OiAxMHB4XHJcblxyXG4udXNlci1zZWN0aW9uXHJcbiAgd2lkdGg6IDUwJVxyXG4gIHBhZGRpbmctbGVmdDogMTBweFxyXG5cclxuLmNhcnQtdGFibGVcclxuICB3aWR0aDogMTAwJVxyXG4gIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2VcclxuICBtYXJnaW4tYm90dG9tOiAyMHB4XHJcblxyXG4uY2FydC10YWJsZSB0aFxyXG4gIGJhY2tncm91bmQtY29sb3I6ICMzMzNcclxuICBjb2xvcjogI2ZmZlxyXG4gIHBhZGRpbmc6IDEwcHhcclxuICB0ZXh0LWFsaWduOiBsZWZ0XHJcblxyXG4uY2FydC10YWJsZSB0ZFxyXG4gIHBhZGRpbmc6IDEwcHhcclxuICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2NjY1xyXG5cclxuXHJcbmgxXHJcbiAgY29sb3I6ICMzMzNcclxuICBmb250LXNpemU6IDI0cHhcclxuICBtYXJnaW4tYm90dG9tOiAyMHB4XHJcblxyXG5oMlxyXG4gIGNvbG9yOiAjMzMzXHJcbiAgZm9udC1zaXplOiAyMHB4XHJcbiAgbWFyZ2luLWJvdHRvbTogMjBweFxyXG5cclxuLnVzZXItZm9ybVxyXG4gIGRpc3BsYXk6IGZsZXhcclxuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uXHJcblxyXG4uZm9ybS1ncm91cFxyXG4gIG1hcmdpbi1ib3R0b206IDEwcHhcclxuXHJcbmxhYmVsXHJcbiAgZm9udC13ZWlnaHQ6IGJvbGRcclxuXHJcbmlucHV0W3R5cGU9XCJ0ZXh0XCJdLFxyXG5pbnB1dFt0eXBlPVwiZW1haWxcIl0sXHJcbmlucHV0W3R5cGU9XCJ0ZWxcIl1cclxuICB3aWR0aDogMTAwJVxyXG4gIHBhZGRpbmc6IDhweCAxMnB4XHJcbiAgYm9yZGVyOiAxcHggc29saWQgI2NjY1xyXG4gIGJvcmRlci1yYWRpdXM6IDRweFxyXG4gIG1hcmdpbi10b3A6IDRweFxyXG4gIGZvbnQtc2l6ZTogMTRweFxyXG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3hcclxuIl19 */\"]\n});","map":{"version":3,"mappings":"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","names":["OrderInfo","Cart","ShippingAddress","FormControl","FormGroup","Validators","i0","CheckoutPageComponent","constructor","orderService","cartService","tokenStorageService","paymentMethodService","street","required","city","country","paymentMethod","ngOnInit","retrievePaymentMethods","Promise","all","retrieveUserCart","retrieveCartItems","updateCartTotal","cart","cartId","subscribe","data","cartItems","error","console","log","retrieveCart","toPromise","then","undefined","getAllPaymentMethods","paymentMethods","validateCheckout","processCheckout","orderInfo","getUser","username","shippingAddress","totalPrice","reduce","total","cartItem","checkoutForm","get","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\mouji\\IdeaProjects\\Fitness-store-2022\\angular-frontend\\src\\app\\components\\shopping\\checkout-page\\checkout-page.component.ts","C:\\Users\\mouji\\IdeaProjects\\Fitness-store-2022\\angular-frontend\\src\\app\\components\\shopping\\checkout-page\\checkout-page.component.html"],"sourcesContent":["import {Component, OnInit} from '@angular/core';\nimport {CartItem} from \"../../../common/shopping/cart-item\";\nimport {OrderService} from \"../../../services/shopping/order/order.service\";\nimport {OrderInfo} from \"../../../common/users/orderInfo\";\nimport {CartService} from \"../../../services/shopping/cart/cart.service\";\nimport {TokenStorageService} from \"../../../services/authentication/token-storage.service\";\nimport {Cart} from \"../../../common/shopping/cart\";\nimport {PaymentMethod} from \"../../../common/shopping/payment-method\";\nimport {PaymentMethodService} from \"../../../services/shopping/payment-method/payment-method.service\";\nimport {ShippingAddress} from \"../../../common/users/shipping-address\";\nimport {FormControl, FormGroup, Validators} from \"@angular/forms\";\n\n@Component({\n  selector: 'app-checkout-page',\n  templateUrl: './checkout-page.component.html',\n  styleUrls: ['./checkout-page.component.sass']\n})\nexport class CheckoutPageComponent implements OnInit {\n\n  checkoutForm: FormGroup = new FormGroup({\n    street: new FormControl('', Validators.required),\n    city: new FormControl(0, Validators.required),\n    country: new FormControl('unisex', Validators.required),\n    paymentMethod: new FormControl('', Validators.required)\n  });\n\n  cart: Cart = new Cart();\n  orderInfo: OrderInfo = new OrderInfo();\n  cartItems: CartItem[] = [];\n  paymentMethods: PaymentMethod[] = [];\n  shippingAddress: ShippingAddress = new ShippingAddress();\n\n  constructor(private orderService: OrderService,\n              private cartService: CartService,\n              private tokenStorageService: TokenStorageService,\n              private paymentMethodService: PaymentMethodService) {\n  }\n\n  async ngOnInit() {\n    //TODO: Transfer this cause it's duplicated code\n    this.retrievePaymentMethods();\n    await Promise.all([this.retrieveUserCart(), this.retrieveCartItems()])\n    this.updateCartTotal();\n  }\n\n  async retrieveCartItems() {\n    await this.retrieveUserCart();\n\n    this.cartService.retrieveCartItems(this.cart.cartId).subscribe(\n      data => {\n        this.cartItems = data;\n        this.updateCartTotal();\n      },\n      error => {\n        console.log(error);\n      }\n    );\n  }\n\n  async retrieveUserCart() {\n    await this.cartService.retrieveCart().toPromise().then(\n      data => {\n        if (data != undefined)\n          this.cart = data;\n      },\n      error => {\n        console.log(error);\n      }\n    );\n  }\n\n  retrievePaymentMethods() {\n    this.paymentMethodService.getAllPaymentMethods().subscribe(\n      data => {\n        this.paymentMethods = data;\n      },\n      error => {\n        console.log(error);\n      }\n    )\n  }\n\n  validateCheckout() {\n    this.orderService.processCheckout(this.orderInfo, this.cartItems, this.tokenStorageService.getUser().username, this.shippingAddress).subscribe(\n      data => {\n        console.log(data)\n      },\n      error => {\n        console.log(error);\n      }\n    )\n  }\n\n  updateCartTotal() {\n    this.cart.totalPrice = this.cartItems.reduce(\n      (total, cartItem) => total + cartItem.totalPrice,\n      0\n    );\n  }\n\n  get street() {return this.checkoutForm.get('street'); }\n  get city() { return this.checkoutForm.get('city'); }\n  get country() { return this.checkoutForm.get('country'); }\n  get paymentMethod() { return this.checkoutForm.get('paymentMethod'); }\n}\n","<div class=\"checkout-page\">\n  <div class=\"cart-section\">\n    <h1>Validation de commande</h1>\n    <table class=\"cart-table\">\n      <thead>\n      <tr>\n        <th>Produit</th>\n        <th>Size</th>\n        <th>Quantité</th>\n        <th>Prix total</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr *ngFor=\"let cartItem of cartItems\">\n        <td>{{cartItem.productInfo.name}}</td>\n        <td>{{cartItem.relatedSizeAndStock.size}}</td>\n        <td>\n          <span class=\"quantity\">{{cartItem.quantity}}</span>\n        </td>\n        <td>{{cartItem.totalPrice}} €</td>\n      </tr>\n      </tbody>\n    </table>\n    <h2>Total: {{cart.totalPrice}} €</h2>\n  </div>\n\n  <div class=\"user-section\">\n    <h2>Informations personnelles</h2>\n    <form [formGroup]=\"checkoutForm\" (ngSubmit)=\"validateCheckout()\" class=\"user-form\">\n      <div class=\"form-group\">\n        <label for=\"street\">Street :</label>\n        <input type=\"text\" id=\"street\" name=\"street\" formControlName=\"street\" [(ngModel)]=\"shippingAddress.streetNameAndNumber\" required>\n        <div *ngIf=\"street?.touched && street?.invalid\" class=\"error-message\">\n          <p style=\"color: red\">Street and number is required.</p>\n        </div>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"city\">City:</label>\n        <input type=\"text\" id=\"city\" name=\"city\"formControlName=\"city\" [(ngModel)]=\"shippingAddress.city\" required>\n        <div *ngIf=\"city?.touched && city?.invalid\" class=\"error-message\">\n          <p style=\"color: red\">City is required.</p>\n        </div>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"country\">Country:</label>\n        <input type=\"text\" id=\"country\" name=\"country\"formControlName=\"country\" [(ngModel)]=\"shippingAddress.country\" required>\n        <div *ngIf=\"country?.touched && country?.invalid\" class=\"error-message\">\n          <p style=\"color: red\">Country is required.</p>\n        </div>\n      </div>\n      <div class=\"form-group\">\n        <select name=\"paymentMethod\" id=\"paymentMethod\"formControlName=\"paymentMethod\" [(ngModel)]=\"orderInfo.paymentMethod\">\n          <option selected>Select a payment method</option>\n          <option *ngFor=\"let paymentMethod of paymentMethods\" [ngValue]=\"paymentMethod\">{{paymentMethod.name}}</option>\n          </select>\n        <div *ngIf=\"paymentMethod?.touched && paymentMethod?.invalid\" class=\"error-message\">\n          <p style=\"color: red\">Payment Method is required.</p>\n        </div>\n      </div>\n      <button class=\"checkout-button\" type=\"submit\">Valider la commande</button>\n    </form>\n  </div>\n</div>\n\n\n"]},"metadata":{},"sourceType":"module"}