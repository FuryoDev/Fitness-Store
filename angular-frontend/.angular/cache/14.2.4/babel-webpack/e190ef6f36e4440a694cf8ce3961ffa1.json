{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/mouji/IdeaProjects/Fitness-store-2022/angular-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Cart } from \"../../../../common/shopping/cart\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../services/shopping/cart/cart.service\";\nimport * as i2 from \"../../../../services/shared/header-shared.service\";\nimport * as i3 from \"../../../../services/shopping/cart/guest-cart.service\";\nimport * as i4 from \"../../../../services/authentication/token-storage.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/router\";\n\nfunction CartPageComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"div\", 3)(2, \"h2\", 4);\n    i0.ɵɵtext(3, \"Your Cart is Empty\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"img\", 5);\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction CartPageComponent_div_2_tr_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"div\", 13);\n    i0.ɵɵelement(3, \"img\", 14);\n    i0.ɵɵelementStart(4, \"div\", 15)(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"small\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"small\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(11, \"br\");\n    i0.ɵɵelementStart(12, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function CartPageComponent_div_2_tr_13_Template_button_click_12_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const i_r4 = restoredCtx.index;\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.removeFromCart(i_r4));\n    });\n    i0.ɵɵtext(13, \"Remove\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(14, \"td\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"td\")(17, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function CartPageComponent_div_2_tr_13_Template_button_click_17_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const i_r4 = restoredCtx.index;\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.changeQty(-1, i_r4));\n    });\n    i0.ɵɵtext(18, \"-\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"span\");\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function CartPageComponent_div_2_tr_13_Template_button_click_21_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const i_r4 = restoredCtx.index;\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.changeQty(1, i_r4));\n    });\n    i0.ɵɵtext(22, \"+\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const item_r3 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"src\", item_r3.productInfo.imageURL, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(item_r3.productInfo.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Price: \", item_r3.productInfo.price.toFixed(2), \" \\u20AC\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Size: \", item_r3.relatedSizeAndStock.size, \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"\", item_r3.totalPrice.toFixed(2), \" \\u20AC\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(item_r3.quantity);\n  }\n}\n\nconst _c0 = function () {\n  return [\"/checkout\"];\n};\n\nfunction CartPageComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"h1\", 6);\n    i0.ɵɵtext(2, \"Your Shopping Cart\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 7)(4, \"table\", 8)(5, \"tr\")(6, \"th\")(7, \"p\");\n    i0.ɵɵtext(8, \"Product\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Total\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"Quantity\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(13, CartPageComponent_div_2_tr_13_Template, 23, 6, \"tr\", 9);\n    i0.ɵɵelementStart(14, \"tr\", 10);\n    i0.ɵɵelement(15, \"td\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"div\", 11)(17, \"h2\");\n    i0.ɵɵtext(18, \"TOTAL: \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"h3\");\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"h2\");\n    i0.ɵɵtext(22, \"Delivery fees\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"h3\");\n    i0.ɵɵtext(24, \"3.5\\u20AC\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"button\")(26, \"a\", 12);\n    i0.ɵɵtext(27, \"Checkout\");\n    i0.ɵɵelementEnd()()()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(13);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.cartItems);\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r1.cart.totalPrice.toFixed(2), \" \\u20AC\");\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(3, _c0));\n  }\n}\n\nexport class CartPageComponent {\n  constructor(cartService, headerService, guestCartService, tokenStorageService) {\n    this.cartService = cartService;\n    this.headerService = headerService;\n    this.guestCartService = guestCartService;\n    this.tokenStorageService = tokenStorageService;\n    this.cart = new Cart();\n    this.cartItems = [];\n  }\n\n  ngOnInit() {\n    this.loadCartAndItems();\n  }\n\n  loadCartAndItems() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this.retrieveUserCart();\n      yield _this.retrieveCartItems();\n    })();\n  }\n\n  retrieveUserCart() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this2.isUserAuthenticated()) {\n        _this2.cartService.retrieveCart().subscribe(data => {\n          _this2.cart = data;\n        });\n      } else {\n        _this2.cart = _this2.guestCartService.retrieveCart();\n      }\n    })();\n  }\n\n  retrieveCartItems() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this3.isUserAuthenticated()) {\n        _this3.cartService.retrieveCartItems(_this3.cart.cartId).subscribe(data => {\n          _this3.cartItems = data;\n        });\n\n        _this3.updateCartTotal();\n      } else {\n        _this3.cartItems = _this3.guestCartService.retrieveCartItems();\n      }\n    })();\n  }\n\n  isUserAuthenticated() {\n    return this.tokenStorageService.getUser() !== undefined;\n  }\n\n  changeQty(value, index) {\n    const cartItem = this.cartItems[index];\n    const newValue = cartItem.quantity + value;\n\n    if (newValue >= 1 && newValue <= 10) {\n      cartItem.quantity = newValue;\n      cartItem.totalPrice = cartItem.quantity * cartItem.productInfo.price;\n      this.updateCartTotal();\n    } else if (newValue < 1) {\n      cartItem.quantity = 1;\n      cartItem.totalPrice = cartItem.quantity * cartItem.productInfo.price;\n      this.updateCartTotal();\n    } else if (newValue > 10) {\n      cartItem.quantity = 10;\n      cartItem.totalPrice = cartItem.quantity * cartItem.productInfo.price;\n      this.updateCartTotal();\n    }\n\n    this.headerService.reloadHeader();\n    this.saveCart(); // Nouvelle méthode pour sauvegarder le panier après chaque modification.\n  }\n\n  removeFromCart(index) {\n    if (index >= 0 && index < this.cartItems.length) {\n      this.cartItems.splice(index, 1);\n    }\n\n    this.updateCartTotal();\n    this.headerService.reloadHeader();\n    this.saveCart(); // Sauvegarde du panier après chaque suppression.\n  }\n\n  saveCart() {\n    if (this.isUserAuthenticated()) {\n      this.cartService.saveCart(this.cart).subscribe(data => {\n        console.log(data);\n      }); // Assurez-vous d'avoir une méthode saveCart() dans votre CartService.\n    } else {\n      this.guestCartService.saveCart(this.cart); // De même, assurez-vous d'avoir une méthode saveCart() dans votre GuestCartService.\n    }\n  }\n\n  updateCartTotal() {\n    this.cart.totalPrice = this.cartItems.reduce((total, cartItem) => total + cartItem.totalPrice, 0);\n  }\n\n}\n\nCartPageComponent.ɵfac = function CartPageComponent_Factory(t) {\n  return new (t || CartPageComponent)(i0.ɵɵdirectiveInject(i1.CartService), i0.ɵɵdirectiveInject(i2.HeaderSharedService), i0.ɵɵdirectiveInject(i3.GuestCartService), i0.ɵɵdirectiveInject(i4.TokenStorageService));\n};\n\nCartPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: CartPageComponent,\n  selectors: [[\"app-cart-page\"]],\n  decls: 3,\n  vars: 2,\n  consts: [[1, \"wrapper\"], [\"class\", \"\", 4, \"ngIf\"], [1, \"\"], [1, \"empty-cart\"], [1, \"empty-cart-title\"], [\"src\", \"assets/images/empty-cart.png\", \"alt\", \"Empty Cart Image\", 1, \"empty-cart-image\"], [1, \"app-title\"], [1, \"cart-container\"], [1, \"cart-table\"], [4, \"ngFor\", \"ngForOf\"], [1, \"horizontal-line\"], [1, \"subtotal-details\"], [3, \"routerLink\"], [1, \"cart-prod-details\"], [\"alt\", \"\", 3, \"src\"], [1, \"cart-texts\"], [3, \"click\"], [1, \"quantity-button\", \"decrement-button\", 3, \"click\"], [1, \"quantity-button\", \"increment-button\", 3, \"click\"]],\n  template: function CartPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵtemplate(1, CartPageComponent_div_1_Template, 5, 0, \"div\", 1);\n      i0.ɵɵtemplate(2, CartPageComponent_div_2_Template, 28, 4, \"div\", 1);\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.cartItems.length == 0);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.cartItems.length > 0);\n    }\n  },\n  dependencies: [i5.NgForOf, i5.NgIf, i6.RouterLinkWithHref],\n  styles: [\".cart-container[_ngcontent-%COMP%] {\\n  margin: 80px auto;\\n}\\n\\n.cart-table[_ngcontent-%COMP%] {\\n  margin: 80px auto;\\n  width: 70%;\\n  border-collapse: collapse;\\n}\\n\\n.cart-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\\n  text-align: left;\\n  padding: 5px;\\n  color: white;\\n  background-color: black;\\n  font-weight: normal;\\n}\\n\\n.cart-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\\n  padding: 10px;\\n}\\n\\n.cart-prod-details[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-wrap: wrap;\\n}\\n\\n.cart-prod-details[_ngcontent-%COMP%]   img[_ngcontent-%COMP%] {\\n  width: 150px;\\n  height: 150px;\\n  margin-right: 10px;\\n}\\n\\n.cart-texts[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n}\\n\\n.total-price[_ngcontent-%COMP%] {\\n  display: flex;\\n  justify-content: flex-end;\\n}\\n\\n.total-price[_ngcontent-%COMP%]   table[_ngcontent-%COMP%] {\\n  border-top: 3px solid red;\\n  width: 100%;\\n  max-width: 350px;\\n}\\n\\n.total-price[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child {\\n  text-align: right;\\n}\\n\\n.total-price[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child {\\n  text-align: right;\\n}\\n\\n.subtotal-details[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: flex-end;\\n  width: 30%;\\n  right: 10px;\\n  position: absolute;\\n}\\n\\n.subtotal-details[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\\n  width: 50%;\\n  margin: 10px 0;\\n}\\n\\n.subtotal-details[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%] {\\n  padding-top: 10px;\\n  text-decoration: underline;\\n}\\n\\n.subtotal-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\\n  padding-top: 10px;\\n}\\n\\n.horizontal-line[_ngcontent-%COMP%] {\\n  border-top: 2px solid black;\\n  width: 70%;\\n  margin: auto;\\n}\\n\\n.quantity-button[_ngcontent-%COMP%] {\\n  color: #fff;\\n  border: none;\\n  padding: 5px 10px;\\n  cursor: pointer;\\n  transition: background-color 0.3s ease;\\n}\\n\\n.quantity-button[_ngcontent-%COMP%]:hover {\\n  background-color: #219653;\\n}\\n\\n.empty-cart[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  justify-content: center;\\n  text-align: center;\\n}\\n\\n.empty-cart-title[_ngcontent-%COMP%] {\\n  margin: auto auto;\\n  font-size: 24px;\\n  font-weight: bold;\\n}\\n\\n.empty-cart-image[_ngcontent-%COMP%] {\\n  max-width: 100%;\\n  max-height: 200px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhcnQtcGFnZS5jb21wb25lbnQuc2FzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGlCQUFBO0FBQ0Y7O0FBQ0E7RUFDRSxpQkFBQTtFQUNBLFVBQUE7RUFDQSx5QkFBQTtBQUVGOztBQUFFO0VBQ0UsZ0JBQUE7RUFDQSxZQUFBO0VBQ0EsWUFBQTtFQUNBLHVCQUFBO0VBQ0EsbUJBQUE7QUFFSjs7QUFDRTtFQUNFLGFBQUE7QUFDSjs7QUFDQTtFQUNFLGFBQUE7RUFDQSxlQUFBO0FBRUY7O0FBQUU7RUFDRSxZQUFBO0VBQ0EsYUFBQTtFQUNBLGtCQUFBO0FBRUo7O0FBQUE7RUFDRSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSx1QkFBQTtBQUdGOztBQURBO0VBQ0UsYUFBQTtFQUNBLHlCQUFBO0FBSUY7O0FBSEU7RUFDRSx5QkFBQTtFQUNBLFdBQUE7RUFDQSxnQkFBQTtBQUtKOztBQUpJO0VBQ0UsaUJBQUE7QUFNTjs7QUFMSTtFQUNFLGlCQUFBO0FBT047O0FBTEE7RUFDRSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSx5QkFBQTtFQUNBLFVBQUE7RUFDQSxXQUFBO0VBQ0Esa0JBQUE7QUFRRjs7QUFORTtFQUNFLFVBQUE7RUFDQSxjQUFBO0FBUUo7O0FBTkU7RUFDRSxpQkFBQTtFQUNBLDBCQUFBO0FBUUo7O0FBTkU7RUFDRSxpQkFBQTtBQVFKOztBQU5BO0VBQ0UsMkJBQUE7RUFDQSxVQUFBO0VBQ0EsWUFBQTtBQVNGOztBQVBBO0VBQ0UsV0FBQTtFQUNBLFlBQUE7RUFDQSxpQkFBQTtFQUNBLGVBQUE7RUFDQSxzQ0FBQTtBQVVGOztBQVJBO0VBQ0UseUJBQUE7QUFXRjs7QUFUQTtFQUNFLGFBQUE7RUFDQSxzQkFBQTtFQUNBLG1CQUFBO0VBQ0EsdUJBQUE7RUFDQSxrQkFBQTtBQVlGOztBQVRBO0VBQ0UsaUJBQUE7RUFDQSxlQUFBO0VBQ0EsaUJBQUE7QUFZRjs7QUFUQTtFQUNFLGVBQUE7RUFDQSxpQkFBQTtBQVlGIiwiZmlsZSI6ImNhcnQtcGFnZS5jb21wb25lbnQuc2FzcyIsInNvdXJjZXNDb250ZW50IjpbIi5jYXJ0LWNvbnRhaW5lclxyXG4gIG1hcmdpbjogODBweCBhdXRvXHJcblxyXG4uY2FydC10YWJsZVxyXG4gIG1hcmdpbjogODBweCBhdXRvXHJcbiAgd2lkdGg6IDcwJVxyXG4gIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2VcclxuXHJcbiAgdGhcclxuICAgIHRleHQtYWxpZ246IGxlZnRcclxuICAgIHBhZGRpbmc6IDVweFxyXG4gICAgY29sb3I6IHdoaXRlXHJcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiBibGFja1xyXG4gICAgZm9udC13ZWlnaHQ6IG5vcm1hbFxyXG5cclxuXHJcbiAgdGRcclxuICAgIHBhZGRpbmc6IDEwcHhcclxuXHJcbi5jYXJ0LXByb2QtZGV0YWlsc1xyXG4gIGRpc3BsYXk6IGZsZXhcclxuICBmbGV4LXdyYXA6IHdyYXBcclxuXHJcbiAgaW1nXHJcbiAgICB3aWR0aDogMTUwcHhcclxuICAgIGhlaWdodDogMTUwcHhcclxuICAgIG1hcmdpbi1yaWdodDogMTBweFxyXG5cclxuLmNhcnQtdGV4dHNcclxuICBkaXNwbGF5OiBmbGV4XHJcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtblxyXG4gIGp1c3RpZnktY29udGVudDogY2VudGVyXHJcblxyXG4udG90YWwtcHJpY2VcclxuICBkaXNwbGF5OiBmbGV4XHJcbiAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZFxyXG4gIHRhYmxlXHJcbiAgICBib3JkZXItdG9wOiAzcHggc29saWQgcmVkXHJcbiAgICB3aWR0aDogMTAwJVxyXG4gICAgbWF4LXdpZHRoOiAzNTBweFxyXG4gICAgdGQ6bGFzdC1jaGlsZFxyXG4gICAgICB0ZXh0LWFsaWduOiByaWdodFxyXG4gICAgdGg6bGFzdC1jaGlsZFxyXG4gICAgICB0ZXh0LWFsaWduOiByaWdodFxyXG5cclxuLnN1YnRvdGFsLWRldGFpbHNcclxuICBkaXNwbGF5OiBmbGV4XHJcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtblxyXG4gIGp1c3RpZnktY29udGVudDogZmxleC1lbmRcclxuICB3aWR0aDogMzAlXHJcbiAgcmlnaHQ6IDEwcHhcclxuICBwb3NpdGlvbjogYWJzb2x1dGVcclxuXHJcbiAgYnV0dG9uXHJcbiAgICB3aWR0aDogNTAlXHJcbiAgICBtYXJnaW46IDEwcHggMFxyXG5cclxuICBoMlxyXG4gICAgcGFkZGluZy10b3A6IDEwcHhcclxuICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lXHJcblxyXG4gIGgzXHJcbiAgICBwYWRkaW5nLXRvcDogMTBweFxyXG5cclxuLmhvcml6b250YWwtbGluZVxyXG4gIGJvcmRlci10b3A6IDJweCBzb2xpZCBibGFja1xyXG4gIHdpZHRoOiA3MCVcclxuICBtYXJnaW46IGF1dG9cclxuXHJcbi5xdWFudGl0eS1idXR0b25cclxuICBjb2xvcjogI2ZmZlxyXG4gIGJvcmRlcjogbm9uZVxyXG4gIHBhZGRpbmc6IDVweCAxMHB4XHJcbiAgY3Vyc29yOiBwb2ludGVyXHJcbiAgdHJhbnNpdGlvbjogYmFja2dyb3VuZC1jb2xvciAwLjNzIGVhc2VcclxuXHJcbi5xdWFudGl0eS1idXR0b246aG92ZXJcclxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjMjE5NjUzXHJcblxyXG4uZW1wdHktY2FydFxyXG4gIGRpc3BsYXk6IGZsZXhcclxuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uXHJcbiAgYWxpZ24taXRlbXM6IGNlbnRlclxyXG4gIGp1c3RpZnktY29udGVudDogY2VudGVyXHJcbiAgdGV4dC1hbGlnbjogY2VudGVyXHJcblxyXG5cclxuLmVtcHR5LWNhcnQtdGl0bGVcclxuICBtYXJnaW46IGF1dG8gYXV0b1xyXG4gIGZvbnQtc2l6ZTogMjRweFxyXG4gIGZvbnQtd2VpZ2h0OiBib2xkXHJcblxyXG5cclxuLmVtcHR5LWNhcnQtaW1hZ2VcclxuICBtYXgtd2lkdGg6IDEwMCVcclxuICBtYXgtaGVpZ2h0OiAyMDBweFxyXG5cclxuXHJcblxyXG4iXX0= */\"]\n});","map":{"version":3,"mappings":"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","names":["Cart","i0","i_r4","CartPageComponent","constructor","cartService","headerService","guestCartService","tokenStorageService","ngOnInit","loadCartAndItems","retrieveUserCart","retrieveCartItems","isUserAuthenticated","retrieveCart","subscribe","data","cart","cartId","cartItems","updateCartTotal","getUser","undefined","changeQty","value","index","cartItem","newValue","quantity","totalPrice","productInfo","price","reloadHeader","saveCart","removeFromCart","length","splice","console","log","reduce","total","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\mouji\\IdeaProjects\\Fitness-store-2022\\angular-frontend\\src\\app\\components\\shopping\\cart\\cart-page\\cart-page.component.ts","C:\\Users\\mouji\\IdeaProjects\\Fitness-store-2022\\angular-frontend\\src\\app\\components\\shopping\\cart\\cart-page\\cart-page.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Cart } from \"../../../../common/shopping/cart\";\nimport { CartService } from \"../../../../services/shopping/cart/cart.service\";\nimport { CartItem } from \"../../../../common/shopping/cart-item\";\nimport { GuestCartService } from \"../../../../services/shopping/cart/guest-cart.service\";\nimport { TokenStorageService } from \"../../../../services/authentication/token-storage.service\";\nimport { HeaderSharedService } from \"../../../../services/shared/header-shared.service\";\n\n@Component({\n  selector: 'app-cart-page',\n  templateUrl: './cart-page.component.html',\n  styleUrls: ['./cart-page.component.sass']\n})\nexport class CartPageComponent implements OnInit {\n\n  cart: Cart = new Cart();\n  cartItems: CartItem[] = [];\n\n  constructor(\n    private cartService: CartService,\n    private headerService: HeaderSharedService,\n    private guestCartService: GuestCartService,\n    private tokenStorageService: TokenStorageService\n  ) {}\n\n  ngOnInit() {\n    this.loadCartAndItems();\n  }\n\n  private async loadCartAndItems() {\n    await this.retrieveUserCart();\n    await this.retrieveCartItems();\n  }\n\n  private async retrieveUserCart() {\n    if (this.isUserAuthenticated()) {\n      this.cartService.retrieveCart().subscribe(\n        data => {\n          this.cart = data;\n        }\n      );\n    } else {\n      this.cart = this.guestCartService.retrieveCart();\n    }\n  }\n\n  private async retrieveCartItems() {\n    if (this.isUserAuthenticated()) {\n      this.cartService.retrieveCartItems(this.cart.cartId).subscribe(\n        data => {\n          this.cartItems = data;\n        }\n      );\n      this.updateCartTotal();\n    } else {\n      this.cartItems = this.guestCartService.retrieveCartItems();\n    }\n  }\n\n  private isUserAuthenticated(): boolean {\n    return this.tokenStorageService.getUser() !== undefined;\n  }\n\n  changeQty(value: number, index: number) {\n    const cartItem = this.cartItems[index];\n    const newValue = cartItem.quantity + value;\n\n    if (newValue >= 1 && newValue <= 10) {\n      cartItem.quantity = newValue;\n      cartItem.totalPrice = cartItem.quantity * cartItem.productInfo.price;\n      this.updateCartTotal();\n    } else if (newValue < 1) {\n      cartItem.quantity = 1;\n      cartItem.totalPrice = cartItem.quantity * cartItem.productInfo.price;\n      this.updateCartTotal();\n    } else if (newValue > 10) {\n      cartItem.quantity = 10;\n      cartItem.totalPrice = cartItem.quantity * cartItem.productInfo.price;\n      this.updateCartTotal();\n    }\n    this.headerService.reloadHeader();\n    this.saveCart();  // Nouvelle méthode pour sauvegarder le panier après chaque modification.\n  }\n\n  removeFromCart(index: number) {\n    if (index >= 0 && index < this.cartItems.length) {\n      this.cartItems.splice(index, 1);\n    }\n    this.updateCartTotal();\n    this.headerService.reloadHeader();\n    this.saveCart();  // Sauvegarde du panier après chaque suppression.\n  }\n\n  private saveCart() {\n    if (this.isUserAuthenticated()) {\n      this.cartService.saveCart(this.cart).subscribe(\n        data => {\n          console.log(data)\n        }\n      ); // Assurez-vous d'avoir une méthode saveCart() dans votre CartService.\n    } else {\n      this.guestCartService.saveCart(this.cart); // De même, assurez-vous d'avoir une méthode saveCart() dans votre GuestCartService.\n    }\n  }\n\n  updateCartTotal() {\n    this.cart.totalPrice = this.cartItems.reduce(\n      (total, cartItem) => total + cartItem.totalPrice,\n      0\n    );\n  }\n}\n","<div class=\"wrapper\">\n  <div class=\"\" *ngIf=\"cartItems.length == 0\">\n    <div class=\"empty-cart\">\n      <h2 class=\"empty-cart-title\">Your Cart is Empty</h2>\n      <img src=\"assets/images/empty-cart.png\" alt=\"Empty Cart Image\" class=\"empty-cart-image\">\n    </div>\n  </div>\n  <div class=\"\" *ngIf=\"cartItems.length > 0\">\n    <h1 class=\"app-title\">Your Shopping Cart</h1>\n    <div class=\"cart-container\">\n      <table class=\"cart-table\">\n        <tr>\n          <th>\n            <p>Product</p>\n          </th>\n          <th>Total</th>\n          <th>Quantity</th>\n        </tr>\n        <tr *ngFor=\"let item of cartItems; let i = index\">\n          <td>\n            <div class=\"cart-prod-details\">\n              <img [src]=\"item.productInfo.imageURL\" alt=\"\">\n              <div class=\"cart-texts\">\n                <p>{{item.productInfo.name}}</p>\n                <small>Price: {{item.productInfo.price.toFixed(2)}} €</small>\n                <small>Size: {{item.relatedSizeAndStock.size}}</small>\n                <br>\n                <button (click)=\"removeFromCart(i)\">Remove</button>\n              </div>\n            </div>\n          </td>\n          <td>{{item.totalPrice.toFixed(2)}} €</td>\n          <td>\n            <button class=\"quantity-button decrement-button\" (click)=\"changeQty(-1, i)\">-</button>\n            <span>{{item.quantity}}</span>\n            <button class=\"quantity-button increment-button\" (click)=\"changeQty(1, i)\">+</button>\n          </td>\n        </tr>\n        <tr class=\"horizontal-line\">\n          <td></td>\n        </tr>\n        <div class=\"subtotal-details\">\n          <h2>TOTAL: </h2>\n          <h3>{{cart.totalPrice.toFixed(2)}} €</h3>\n          <h2>Delivery fees</h2>\n          <h3>3.5€</h3>\n          <button><a [routerLink]=\"['/checkout']\">Checkout</a></button>\n        </div>\n      </table>\n    </div>\n  </div>\n</div>\n"]},"metadata":{},"sourceType":"module"}