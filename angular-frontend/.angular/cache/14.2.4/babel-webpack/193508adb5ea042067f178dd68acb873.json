{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/mouji/IdeaProjects/Fitness-store-2022/angular-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ProductInfo } from \"../../../../common/shopping/product-info\";\nimport { CartItem } from \"../../../../common/shopping/cart-item\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../../../services/product.service\";\nimport * as i3 from \"../../../../services/prod-details/stock.service\";\nimport * as i4 from \"../../../../services/shopping/cart/cart.service\";\nimport * as i5 from \"../../../../services/authentication/token-storage.service\";\nimport * as i6 from \"../../../../services/shopping/cart/guest-cart.service\";\nimport * as i7 from \"@angular/common\";\n\nfunction ProductPageComponent_button_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function ProductPageComponent_button_18_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r3);\n      const size_r1 = restoredCtx.$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.selectSize(size_r1));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const size_r1 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"selected\", ctx_r0.isSelectedSize(size_r1));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(size_r1.size);\n  }\n}\n\nexport class ProductPageComponent {\n  constructor(route, productService, stockService, cartService, tokenStorageService, guestCartService) {\n    this.route = route;\n    this.productService = productService;\n    this.stockService = stockService;\n    this.cartService = cartService;\n    this.tokenStorageService = tokenStorageService;\n    this.guestCartService = guestCartService;\n    this.productInfo = new ProductInfo();\n    this.currentProductId = 0;\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.cartItem = new CartItem();\n      _this.cartItem.quantity = 1; // use Promise.all() to wait for both getProductById() and getAStock() to complete\n\n      yield Promise.all([_this.getProductById(), _this.getAStock()]);\n    })();\n  }\n\n  getAStock() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      // wait for getProductById() to complete before accessing its data\n      yield _this2.getProductById();\n\n      if (_this2.productInfo !== null) {\n        _this2.stockService.findStockByProduct(_this2.productInfo.productId).subscribe(data => {\n          if (data.length == 1) {\n            _this2.cartItem.relatedSizeAndStock = data[0];\n          } else {\n            _this2.stocks = data;\n          }\n        });\n      }\n    })();\n  }\n\n  getProductById() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      _this3.currentProductId = +_this3.route.snapshot.paramMap.get('prodId'); // set the productInfo value and wait for it to complete\n\n      yield _this3.productService.getProductById(_this3.currentProductId).toPromise().then(data => {\n        if (data != undefined) _this3.productInfo = data;\n      });\n    })();\n  }\n\n  addToCart() {\n    if (this.isThereEnoughInStock()) {\n      let user = this.tokenStorageService.getUser(); //TODO: Use this service in ProductPageComponent and CartPageComponent\n      //TODO: Check if enough in stock\n\n      this.cartItem.productInfo = this.productInfo;\n\n      if (this.tokenStorageService.getUser() == undefined) {\n        console.log('we in here biatch');\n        this.addToCartTwo(this.cartItem);\n      } else {\n        this.cartService.addToCart(this.cartItem).subscribe();\n      }\n    } else {\n      this.errorMessage = 'You picked the maximum of item left in stock';\n    }\n  }\n\n  addToCartTwo(cartItem) {\n    const existingCartItem = this.guestCartService.cartItems.find(item => item.productInfo.productId === cartItem.productInfo.productId && item.relatedSizeAndStock.stockId === cartItem.relatedSizeAndStock.stockId);\n\n    if (existingCartItem) {\n      existingCartItem.quantity += cartItem.quantity;\n    } else {\n      this.guestCartService.cartItems.push(cartItem);\n    }\n  }\n\n  selectSize(size) {\n    this.cartItem.relatedSizeAndStock = size;\n  }\n\n  isThereEnoughInStock() {\n    if (this.cartItem.relatedSizeAndStock != null || undefined) {\n      let amountInStock = this.cartItem.relatedSizeAndStock.itemsInStock - this.cartItem.quantity;\n      return amountInStock <= 0;\n    } else {\n      return true;\n    }\n  }\n\n  isSelectedSize(size) {\n    return this.cartItem.relatedSizeAndStock === size;\n  }\n\n  isSizeSelected() {\n    return this.cartItem.relatedSizeAndStock !== undefined;\n  }\n\n  changeQty(value) {\n    const newValue = this.cartItem.quantity + value;\n\n    if (newValue >= 1 && newValue <= 10) {\n      this.cartItem.quantity = newValue;\n    } else if (newValue < 1) {\n      this.cartItem.quantity = 1;\n    } else if (newValue > 10) {\n      this.cartItem.quantity = 10;\n    }\n  }\n\n}\n\nProductPageComponent.ɵfac = function ProductPageComponent_Factory(t) {\n  return new (t || ProductPageComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.ProductService), i0.ɵɵdirectiveInject(i3.StockService), i0.ɵɵdirectiveInject(i4.CartService), i0.ɵɵdirectiveInject(i5.TokenStorageService), i0.ɵɵdirectiveInject(i6.GuestCartService));\n};\n\nProductPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ProductPageComponent,\n  selectors: [[\"app-product-page\"]],\n  decls: 27,\n  vars: 7,\n  consts: [[1, \"content\"], [1, \"details-container\"], [1, \"product-name\"], [1, \"product-price\"], [1, \"horizontal-line\"], [1, \"product-size\"], [1, \"product-buttons\"], [1, \"quantity-buttons\"], [1, \"round-button\", 3, \"click\"], [1, \"round-button\", 3, \"disabled\", \"click\"], [1, \"size-buttons\"], [\"class\", \"product-btn\", 3, \"selected\", \"click\", 4, \"ngFor\", \"ngForOf\"], [2, \"color\", \"red\"], [1, \"add-to-cart-btn\", 3, \"disabled\", \"click\"], [1, \"product-description\"], [1, \"image-container\"], [1, \"product-image\", 3, \"src\"], [1, \"product-btn\", 3, \"click\"]],\n  template: function ProductPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\", 2);\n      i0.ɵɵtext(3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(4, \"p\", 3);\n      i0.ɵɵtext(5, \" 200 \\u20AC \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(6, \"hr\", 4);\n      i0.ɵɵelementStart(7, \"p\", 5);\n      i0.ɵɵtext(8, \"size\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(9, \"div\", 6)(10, \"div\", 7)(11, \"button\", 8);\n      i0.ɵɵlistener(\"click\", function ProductPageComponent_Template_button_click_11_listener() {\n        return ctx.changeQty(-1);\n      });\n      i0.ɵɵtext(12, \"-\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(13, \"p\");\n      i0.ɵɵtext(14);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(15, \"button\", 9);\n      i0.ɵɵlistener(\"click\", function ProductPageComponent_Template_button_click_15_listener() {\n        return ctx.changeQty(1);\n      });\n      i0.ɵɵtext(16, \"+\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(17, \"div\", 10);\n      i0.ɵɵtemplate(18, ProductPageComponent_button_18_Template, 2, 3, \"button\", 11);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(19, \"p\", 12);\n      i0.ɵɵtext(20);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(21, \"button\", 13);\n      i0.ɵɵlistener(\"click\", function ProductPageComponent_Template_button_click_21_listener() {\n        return ctx.addToCart();\n      });\n      i0.ɵɵtext(22, \"Add to cart\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(23, \"p\", 14);\n      i0.ɵɵtext(24, \"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus ad adipisci aliquid atque autem blanditiis consequuntur delectus eius explicabo impedit inventore ipsa, maiores molestiae, mollitia numquam optio perspiciatis, tempora ut.\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(25, \"div\", 15);\n      i0.ɵɵelement(26, \"img\", 16);\n      i0.ɵɵelementEnd()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate(ctx.productInfo.name);\n      i0.ɵɵadvance(11);\n      i0.ɵɵtextInterpolate(ctx.cartItem.quantity);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"disabled\", !ctx.isThereEnoughInStock());\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngForOf\", ctx.stocks);\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate(ctx.errorMessage);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"disabled\", !ctx.isSizeSelected());\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"src\", ctx.productInfo.imageURL, i0.ɵɵsanitizeUrl);\n    }\n  },\n  dependencies: [i7.NgForOf],\n  styles: [\".product-page[_ngcontent-%COMP%] {\\n  display: flex;\\n  padding: 20px 30px;\\n  justify-content: space-around;\\n}\\n\\n.details-container[_ngcontent-%COMP%] {\\n  width: 60%;\\n  text-align: center;\\n}\\n\\n.product-name[_ngcontent-%COMP%] {\\n  text-transform: uppercase;\\n  padding: 20px 0;\\n  font-size: 40px;\\n}\\n\\n.product-price[_ngcontent-%COMP%] {\\n  font-size: 25px;\\n  color: red;\\n  padding: 30px 0;\\n}\\n\\n.horizontal-line[_ngcontent-%COMP%] {\\n  border-top: 2px solid black;\\n  width: 70%;\\n  margin: auto;\\n}\\n\\n.product-size[_ngcontent-%COMP%] {\\n  padding-top: 30px;\\n}\\n\\n.quantity-buttons[_ngcontent-%COMP%] {\\n  display: flex;\\n  justify-content: center;\\n}\\n\\n.product-buttons[_ngcontent-%COMP%] {\\n  padding: 27px 0;\\n}\\n\\n.size-buttons[_ngcontent-%COMP%] {\\n  color: yellow;\\n}\\n\\n.product-btn[_ngcontent-%COMP%]:link, .product-btn[_ngcontent-%COMP%]:visited {\\n  outline: none;\\n  text-decoration: none;\\n  padding: 10px 10px;\\n  background-color: white;\\n  border: solid 1.2px black;\\n  cursor: pointer;\\n}\\n\\n.add-to-cart-btn[_ngcontent-%COMP%] {\\n  transform: skew(-15deg);\\n  font-size: 14px;\\n  text-transform: uppercase;\\n  letter-spacing: 2px;\\n  border: none;\\n  outline: none;\\n  background-color: #b50000;\\n  color: white;\\n  font-weight: 600;\\n  width: 80%;\\n  padding: 20px 20px;\\n  margin-top: 20px;\\n}\\n\\n.add-to-cart-btn[_ngcontent-%COMP%]:disabled {\\n  background-color: #cd9a9a;\\n}\\n\\n.add-to-cart-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%] {\\n  display: inline-block;\\n  transform: skew(15deg);\\n}\\n\\n.add-to-cart-btn[_ngcontent-%COMP%]:active {\\n  background-color: #980000;\\n}\\n\\n.product-description[_ngcontent-%COMP%] {\\n  width: 85%;\\n  margin: auto;\\n  text-align: center;\\n  padding-top: 30px;\\n  font-size: 17px;\\n}\\n\\n.image-container[_ngcontent-%COMP%] {\\n  margin-top: 50px;\\n  flex: 0 0 45%;\\n}\\n\\n.product-image[_ngcontent-%COMP%] {\\n  display: table-cell;\\n  text-align: center;\\n  height: 100%;\\n  margin: auto;\\n}\\n\\n.selected[_ngcontent-%COMP%] {\\n  background-color: white;\\n  color: black;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2R1Y3QtcGFnZS5jb21wb25lbnQuc2FzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGFBQUE7RUFDQSxrQkFBQTtFQUNBLDZCQUFBO0FBQ0Y7O0FBQ0E7RUFDRSxVQUFBO0VBQ0Esa0JBQUE7QUFFRjs7QUFBQTtFQUNFLHlCQUFBO0VBQ0EsZUFBQTtFQUNBLGVBQUE7QUFHRjs7QUFEQTtFQUNFLGVBQUE7RUFDQSxVQUFBO0VBQ0EsZUFBQTtBQUlGOztBQUZBO0VBQ0UsMkJBQUE7RUFDQSxVQUFBO0VBQ0EsWUFBQTtBQUtGOztBQUhBO0VBQ0UsaUJBQUE7QUFNRjs7QUFKQTtFQUNFLGFBQUE7RUFDQSx1QkFBQTtBQU9GOztBQUxBO0VBQ0UsZUFBQTtBQVFGOztBQU5BO0VBQ0UsYUFBQTtBQVNGOztBQU5FO0VBRUUsYUFBQTtFQUNBLHFCQUFBO0VBQ0Esa0JBQUE7RUFDQSx1QkFBQTtFQUNBLHlCQUFBO0VBQ0EsZUFBQTtBQVFKOztBQU5BO0VBQ0UsdUJBQUE7RUFDQSxlQUFBO0VBQ0EseUJBQUE7RUFDQSxtQkFBQTtFQUNBLFlBQUE7RUFDQSxhQUFBO0VBQ0EseUJBQUE7RUFDQSxZQUFBO0VBQ0EsZ0JBQUE7RUFDQSxVQUFBO0VBQ0Esa0JBQUE7RUFDQSxnQkFBQTtBQVNGOztBQVJFO0VBQ0UseUJBQUE7QUFVSjs7QUFSRTtFQUNFLHFCQUFBO0VBQ0Esc0JBQUE7QUFVSjs7QUFSRTtFQUNFLHlCQUFBO0FBVUo7O0FBUkE7RUFDRSxVQUFBO0VBQ0EsWUFBQTtFQUNBLGtCQUFBO0VBQ0EsaUJBQUE7RUFDQSxlQUFBO0FBV0Y7O0FBVEE7RUFDRSxnQkFBQTtFQUNBLGFBQUE7QUFZRjs7QUFWQTtFQUNFLG1CQUFBO0VBQ0Esa0JBQUE7RUFDQSxZQUFBO0VBQ0EsWUFBQTtBQWFGOztBQVhBO0VBQ0UsdUJBQUE7RUFDQSxZQUFBO0FBY0YiLCJmaWxlIjoicHJvZHVjdC1wYWdlLmNvbXBvbmVudC5zYXNzIiwic291cmNlc0NvbnRlbnQiOlsiLnByb2R1Y3QtcGFnZVxyXG4gIGRpc3BsYXk6IGZsZXhcclxuICBwYWRkaW5nOiAyMHB4IDMwcHhcclxuICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWFyb3VuZFxyXG5cclxuLmRldGFpbHMtY29udGFpbmVyXHJcbiAgd2lkdGg6IDYwJVxyXG4gIHRleHQtYWxpZ246IGNlbnRlclxyXG5cclxuLnByb2R1Y3QtbmFtZVxyXG4gIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2VcclxuICBwYWRkaW5nOiAyMHB4IDBcclxuICBmb250LXNpemU6IDQwcHhcclxuXHJcbi5wcm9kdWN0LXByaWNlXHJcbiAgZm9udC1zaXplOiAyNXB4XHJcbiAgY29sb3I6IHJlZFxyXG4gIHBhZGRpbmc6IDMwcHggMFxyXG5cclxuLmhvcml6b250YWwtbGluZVxyXG4gIGJvcmRlci10b3A6IDJweCBzb2xpZCBibGFja1xyXG4gIHdpZHRoOiA3MCVcclxuICBtYXJnaW46IGF1dG9cclxuXHJcbi5wcm9kdWN0LXNpemVcclxuICBwYWRkaW5nLXRvcDogMzBweFxyXG5cclxuLnF1YW50aXR5LWJ1dHRvbnNcclxuICBkaXNwbGF5OiBmbGV4XHJcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXJcclxuXHJcbi5wcm9kdWN0LWJ1dHRvbnNcclxuICBwYWRkaW5nOiAyN3B4IDBcclxuXHJcbi5zaXplLWJ1dHRvbnNcclxuICBjb2xvcjogeWVsbG93XHJcblxyXG4ucHJvZHVjdC1idG5cclxuICAmOmxpbmssXHJcbiAgJjp2aXNpdGVkXHJcbiAgICBvdXRsaW5lOiBub25lXHJcbiAgICB0ZXh0LWRlY29yYXRpb246IG5vbmVcclxuICAgIHBhZGRpbmc6IDEwcHggMTBweFxyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGVcclxuICAgIGJvcmRlcjogc29saWQgMS4ycHggYmxhY2tcclxuICAgIGN1cnNvcjogcG9pbnRlclxyXG5cclxuLmFkZC10by1jYXJ0LWJ0blxyXG4gIHRyYW5zZm9ybTogc2tldygtMTVkZWcpXHJcbiAgZm9udC1zaXplOiAxNHB4XHJcbiAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZVxyXG4gIGxldHRlci1zcGFjaW5nOiAycHhcclxuICBib3JkZXI6IG5vbmVcclxuICBvdXRsaW5lOiBub25lXHJcbiAgYmFja2dyb3VuZC1jb2xvcjogI2I1MDAwMFxyXG4gIGNvbG9yOiB3aGl0ZVxyXG4gIGZvbnQtd2VpZ2h0OiA2MDBcclxuICB3aWR0aDogODAlXHJcbiAgcGFkZGluZzogMjBweCAyMHB4XHJcbiAgbWFyZ2luLXRvcDogMjBweFxyXG4gICY6ZGlzYWJsZWRcclxuICAgIGJhY2tncm91bmQtY29sb3I6ICNjZDlhOWFcclxuXHJcbiAgc3BhblxyXG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrXHJcbiAgICB0cmFuc2Zvcm06IHNrZXcoMTVkZWcpXHJcblxyXG4gICY6YWN0aXZlXHJcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjOTgwMDAwXHJcblxyXG4ucHJvZHVjdC1kZXNjcmlwdGlvblxyXG4gIHdpZHRoOiA4NSVcclxuICBtYXJnaW46IGF1dG9cclxuICB0ZXh0LWFsaWduOiBjZW50ZXJcclxuICBwYWRkaW5nLXRvcDogMzBweFxyXG4gIGZvbnQtc2l6ZTogMTdweFxyXG5cclxuLmltYWdlLWNvbnRhaW5lclxyXG4gIG1hcmdpbi10b3A6IDUwcHhcclxuICBmbGV4OiAwIDAgNDUlXHJcblxyXG4ucHJvZHVjdC1pbWFnZVxyXG4gIGRpc3BsYXk6IHRhYmxlLWNlbGxcclxuICB0ZXh0LWFsaWduOiBjZW50ZXJcclxuICBoZWlnaHQ6IDEwMCVcclxuICBtYXJnaW46IGF1dG9cclxuXHJcbi5zZWxlY3RlZFxyXG4gIGJhY2tncm91bmQtY29sb3I6IHdoaXRlXHJcbiAgY29sb3I6IGJsYWNrXHJcblxyXG5cclxuXHJcblxyXG4iXX0= */\"]\n});","map":{"version":3,"mappings":";AACA,SAAQA,WAAR,QAA0B,0CAA1B;AAGA,SAAQC,QAAR,QAAuB,uCAAvB;;;;;;;;;;;;;;ICWQC;IAAoCA;MAAA;MAAA;MAAA;MAAA,OAASA,0CAAT;IAAyB,CAAzB;IAAuFA;IAAaA;;;;;;IAAzEA;IAA4DA;IAAAA;;;;ADEnI,OAAM,MAAOC,oBAAP,CAA2B;EAS/BC,YAAoBC,KAApB,EACoBC,cADpB,EAEoBC,YAFpB,EAGoBC,WAHpB,EAIoBC,mBAJpB,EAKoBC,gBALpB,EAKsD;IALlC;IACA;IACA;IACA;IACA;IACA;IAZpB,mBAA2B,IAAIV,WAAJ,EAA3B;IAEA,wBAA2B,CAA3B;EAWC;;EAEKW,QAAQ;IAAA;;IAAA;MACZ,KAAI,CAACC,QAAL,GAAgB,IAAIX,QAAJ,EAAhB;MACA,KAAI,CAACW,QAAL,CAAcC,QAAd,GAAyB,CAAzB,CAFY,CAGZ;;MACA,MAAMC,OAAO,CAACC,GAAR,CAAY,CAAC,KAAI,CAACC,cAAL,EAAD,EAAwB,KAAI,CAACC,SAAL,EAAxB,CAAZ,CAAN;IAJY;EAKb;;EAEKA,SAAS;IAAA;;IAAA;MACb;MACA,MAAM,MAAI,CAACD,cAAL,EAAN;;MAEA,IAAI,MAAI,CAACE,WAAL,KAAqB,IAAzB,EAA+B;QAC7B,MAAI,CAACX,YAAL,CAAkBY,kBAAlB,CAAqC,MAAI,CAACD,WAAL,CAAiBE,SAAtD,EAAiEC,SAAjE,CAA2EC,IAAI,IAAG;UAChF,IAAIA,IAAI,CAACC,MAAL,IAAe,CAAnB,EAAsB;YACpB,MAAI,CAACX,QAAL,CAAcY,mBAAd,GAAoCF,IAAI,CAAC,CAAD,CAAxC;UACD,CAFD,MAEO;YACL,MAAI,CAACG,MAAL,GAAcH,IAAd;UACD;QACF,CAND;MAOD;IAZY;EAad;;EAEKN,cAAc;IAAA;;IAAA;MAClB,MAAI,CAACU,gBAAL,GAAwB,CAAC,MAAI,CAACrB,KAAL,CAAWsB,QAAX,CAAoBC,QAApB,CAA6BC,GAA7B,CAAiC,QAAjC,CAAzB,CADkB,CAGlB;;MACA,MAAM,MAAI,CAACvB,cAAL,CAAoBU,cAApB,CAAmC,MAAI,CAACU,gBAAxC,EAA0DI,SAA1D,GAAsEC,IAAtE,CACJT,IAAI,IAAG;QACL,IAAIA,IAAI,IAAIU,SAAZ,EACE,MAAI,CAACd,WAAL,GAAmBI,IAAnB;MACH,CAJG,CAAN;IAJkB;EAUnB;;EAGDW,SAAS;IACP,IAAI,KAAKC,oBAAL,EAAJ,EAAiC;MAC/B,IAAIC,IAAI,GAAG,KAAK1B,mBAAL,CAAyB2B,OAAzB,EAAX,CAD+B,CAE/B;MACA;;MACA,KAAKxB,QAAL,CAAcM,WAAd,GAA4B,KAAKA,WAAjC;;MACA,IAAI,KAAKT,mBAAL,CAAyB2B,OAAzB,MAAsCJ,SAA1C,EAAqD;QACnDK,OAAO,CAACC,GAAR,CAAY,mBAAZ;QACA,KAAKC,YAAL,CAAkB,KAAK3B,QAAvB;MACD,CAHD,MAGO;QACL,KAAKJ,WAAL,CAAiByB,SAAjB,CAA2B,KAAKrB,QAAhC,EAA0CS,SAA1C;MACD;IAEF,CAZD,MAYO;MACL,KAAKmB,YAAL,GAAoB,8CAApB;IACD;EAEF;;EAEDD,YAAY,CAAC3B,QAAD,EAAmB;IAC7B,MAAM6B,gBAAgB,GAAG,KAAK/B,gBAAL,CAAsBgC,SAAtB,CAAgCC,IAAhC,CAAqCC,IAAI,IAChEA,IAAI,CAAC1B,WAAL,CAAiBE,SAAjB,KAA+BR,QAAQ,CAACM,WAAT,CAAqBE,SAApD,IAAiEwB,IAAI,CAACpB,mBAAL,CAAyBqB,OAAzB,KAAqCjC,QAAQ,CAACY,mBAAT,CAA6BqB,OAD5G,CAAzB;;IAIA,IAAIJ,gBAAJ,EAAsB;MACpBA,gBAAgB,CAAC5B,QAAjB,IAA6BD,QAAQ,CAACC,QAAtC;IACD,CAFD,MAEO;MACL,KAAKH,gBAAL,CAAsBgC,SAAtB,CAAgCI,IAAhC,CAAqClC,QAArC;IACD;EACF;;EAEDmC,UAAU,CAACC,IAAD,EAAU;IAClB,KAAKpC,QAAL,CAAcY,mBAAd,GAAoCwB,IAApC;EACD;;EAEDd,oBAAoB;IAClB,IAAG,KAAKtB,QAAL,CAAcY,mBAAd,IAAqC,IAArC,IAA6CQ,SAAhD,EAA2D;MACzD,IAAIiB,aAAa,GAAG,KAAKrC,QAAL,CAAcY,mBAAd,CAAkC0B,YAAlC,GAAiD,KAAKtC,QAAL,CAAcC,QAAnF;MACA,OAAOoC,aAAa,IAAI,CAAxB;IACD,CAHD,MAIK;MACH,OAAO,IAAP;IACD;EACF;;EAEDE,cAAc,CAACH,IAAD,EAAY;IACxB,OAAO,KAAKpC,QAAL,CAAcY,mBAAd,KAAsCwB,IAA7C;EACD;;EAEDI,cAAc;IACZ,OAAO,KAAKxC,QAAL,CAAcY,mBAAd,KAAsCQ,SAA7C;EACD;;EAEDqB,SAAS,CAACC,KAAD,EAAc;IACrB,MAAMC,QAAQ,GAAG,KAAK3C,QAAL,CAAcC,QAAd,GAAyByC,KAA1C;;IAEA,IAAIC,QAAQ,IAAI,CAAZ,IAAiBA,QAAQ,IAAI,EAAjC,EAAqC;MACnC,KAAK3C,QAAL,CAAcC,QAAd,GAAyB0C,QAAzB;IACD,CAFD,MAEO,IAAIA,QAAQ,GAAG,CAAf,EAAkB;MACvB,KAAK3C,QAAL,CAAcC,QAAd,GAAyB,CAAzB;IACD,CAFM,MAEA,IAAI0C,QAAQ,GAAG,EAAf,EAAmB;MACxB,KAAK3C,QAAL,CAAcC,QAAd,GAAyB,EAAzB;IACD;EACF;;AAnH8B;;;mBAApBV,sBAAoBD;AAAA;;;QAApBC;EAAoBqD;EAAAC;EAAAC;EAAAC;EAAAC;IAAA;MCjBjC1D,+BAAqB,CAArB,EAAqB,KAArB,EAAqB,CAArB,EAAqB,CAArB,EAAqB,IAArB,EAAqB,CAArB;MAE6BA;MAAoBA;MAC7CA;MACEA;MACFA;MACAA;MACAA;MAAwBA;MAAIA;MAC5BA,+BAA6B,EAA7B,EAA6B,KAA7B,EAA6B,CAA7B,EAA6B,EAA7B,EAA6B,QAA7B,EAA6B,CAA7B;MAEiCA;QAAA,OAAS2D,eAAW,CAAX,CAAT;MAAsB,CAAtB;MAAwB3D;MAACA;MACtDA;MAAGA;MAAqBA;MACxBA;MAA6BA;QAAA,OAAS2D,cAAU,CAAV,CAAT;MAAqB,CAArB;MAA6D3D;MAACA;MAE7FA;MACEA;MACFA;MAEFA;MAAsBA;MAAgBA;MACtCA;MAAgCA;QAAA,OAAS2D,eAAT;MAAoB,CAApB;MAAqD3D;MAAWA;MAChGA;MAA+BA;MAEmBA;MAEpDA;MACEA;MACFA;;;;MAxB2BA;MAAAA;MASlBA;MAAAA;MACkDA;MAAAA;MAG5BA;MAAAA;MAGPA;MAAAA;MACgCA;MAAAA;MAMjDA;MAAAA","names":["ProductInfo","CartItem","i0","ProductPageComponent","constructor","route","productService","stockService","cartService","tokenStorageService","guestCartService","ngOnInit","cartItem","quantity","Promise","all","getProductById","getAStock","productInfo","findStockByProduct","productId","subscribe","data","length","relatedSizeAndStock","stocks","currentProductId","snapshot","paramMap","get","toPromise","then","undefined","addToCart","isThereEnoughInStock","user","getUser","console","log","addToCartTwo","errorMessage","existingCartItem","cartItems","find","item","stockId","push","selectSize","size","amountInStock","itemsInStock","isSelectedSize","isSizeSelected","changeQty","value","newValue","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["C:\\Users\\mouji\\IdeaProjects\\Fitness-store-2022\\angular-frontend\\src\\app\\components\\shopping\\showcase\\product-page\\product-page.component.ts","C:\\Users\\mouji\\IdeaProjects\\Fitness-store-2022\\angular-frontend\\src\\app\\components\\shopping\\showcase\\product-page\\product-page.component.html"],"sourcesContent":["import {Component, OnInit} from '@angular/core';\nimport {ProductInfo} from \"../../../../common/shopping/product-info\";\nimport {ProductService} from \"../../../../services/product.service\";\nimport {ActivatedRoute} from \"@angular/router\";\nimport {CartItem} from \"../../../../common/shopping/cart-item\";\nimport {CartService} from \"../../../../services/shopping/cart/cart.service\";\nimport {Stock} from \"../../../../common/prod-details/stock\";\nimport {StockService} from \"../../../../services/prod-details/stock.service\";\nimport {UserService} from \"../../../../services/authentication/user.service\";\nimport {TokenStorageService} from \"../../../../services/authentication/token-storage.service\";\nimport {GuestCartService} from \"../../../../services/shopping/cart/guest-cart.service\";\n\n@Component({\n  selector: 'app-product-page',\n  templateUrl: './product-page.component.html',\n  styleUrls: ['./product-page.component.sass']\n})\nexport class ProductPageComponent implements OnInit {\n\n  productInfo: ProductInfo = new ProductInfo();\n  cartItem!: CartItem;\n  currentProductId: number = 0;\n  stocks!: Stock[];\n  errorMessage!: string;\n\n\n  constructor(private route: ActivatedRoute,\n              private productService: ProductService,\n              private stockService: StockService,\n              private cartService: CartService,\n              private tokenStorageService: TokenStorageService,\n              private guestCartService: GuestCartService) {\n  }\n\n  async ngOnInit() {\n    this.cartItem = new CartItem();\n    this.cartItem.quantity = 1;\n    // use Promise.all() to wait for both getProductById() and getAStock() to complete\n    await Promise.all([this.getProductById(), this.getAStock()]);\n  }\n\n  async getAStock() {\n    // wait for getProductById() to complete before accessing its data\n    await this.getProductById();\n\n    if (this.productInfo !== null) {\n      this.stockService.findStockByProduct(this.productInfo.productId).subscribe(data => {\n        if (data.length == 1) {\n          this.cartItem.relatedSizeAndStock = data[0];\n        } else {\n          this.stocks = data;\n        }\n      })\n    }\n  }\n\n  async getProductById() {\n    this.currentProductId = +this.route.snapshot.paramMap.get('prodId')!;\n\n    // set the productInfo value and wait for it to complete\n    await this.productService.getProductById(this.currentProductId).toPromise().then(\n      data => {\n        if (data != undefined)\n          this.productInfo = data;\n      }\n    );\n  }\n\n\n  addToCart() {\n    if (this.isThereEnoughInStock()) {\n      let user = this.tokenStorageService.getUser();\n      //TODO: Use this service in ProductPageComponent and CartPageComponent\n      //TODO: Check if enough in stock\n      this.cartItem.productInfo = this.productInfo;\n      if (this.tokenStorageService.getUser() == undefined) {\n        console.log('we in here biatch')\n        this.addToCartTwo(this.cartItem);\n      } else {\n        this.cartService.addToCart(this.cartItem).subscribe()\n      }\n\n    } else {\n      this.errorMessage = 'You picked the maximum of item left in stock'\n    }\n\n  }\n\n  addToCartTwo(cartItem: CartItem) {\n    const existingCartItem = this.guestCartService.cartItems.find(item =>\n      item.productInfo.productId === cartItem.productInfo.productId && item.relatedSizeAndStock.stockId === cartItem.relatedSizeAndStock.stockId\n    );\n\n    if (existingCartItem) {\n      existingCartItem.quantity += cartItem.quantity;\n    } else {\n      this.guestCartService.cartItems.push(cartItem);\n    }\n  }\n\n  selectSize(size: any) {\n    this.cartItem.relatedSizeAndStock = size;\n  }\n\n  isThereEnoughInStock(): boolean {\n    if(this.cartItem.relatedSizeAndStock != null || undefined) {\n      let amountInStock = this.cartItem.relatedSizeAndStock.itemsInStock - this.cartItem.quantity;\n      return amountInStock <= 0;\n    }\n    else {\n      return true;\n    }\n  }\n\n  isSelectedSize(size: Stock): boolean {\n    return this.cartItem.relatedSizeAndStock === size;\n  }\n\n  isSizeSelected(): boolean {\n    return this.cartItem.relatedSizeAndStock !== undefined;\n  }\n\n  changeQty(value: number) {\n    const newValue = this.cartItem.quantity + value;\n\n    if (newValue >= 1 && newValue <= 10) {\n      this.cartItem.quantity = newValue;\n    } else if (newValue < 1) {\n      this.cartItem.quantity = 1;\n    } else if (newValue > 10) {\n      this.cartItem.quantity = 10;\n    }\n  }\n}\n","<div class=\"content\">\n  <div class=\"details-container\">\n    <h1 class=\"product-name\">{{productInfo.name}}</h1>\n    <p class=\"product-price\">\n      200 €\n    </p>\n    <hr class=\"horizontal-line\">\n    <p class=\"product-size\">size</p>\n    <div class=\"product-buttons\">\n      <div class=\"quantity-buttons\">\n        <button class=\"round-button\" (click)=\"changeQty(-1)\">-</button>\n        <p>{{cartItem.quantity}}</p>\n        <button class=\"round-button\" (click)=\"changeQty(1)\"  [disabled]=\"!isThereEnoughInStock()\">+</button>\n      </div>\n      <div class=\"size-buttons\">\n        <button *ngFor=\"let size of stocks\" (click)=\"selectSize(size)\" [class.selected]=\"isSelectedSize(size)\" class=\"product-btn\">{{size.size}}</button>\n      </div>\n    </div>\n    <p style=\"color: red\">{{errorMessage}}</p>\n    <button class=\"add-to-cart-btn\" (click)=\"addToCart()\" [disabled]=\"!isSizeSelected()\">Add to cart</button>\n    <p class=\"product-description\">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus ad adipisci\n      aliquid atque autem blanditiis consequuntur delectus eius explicabo impedit inventore ipsa, maiores molestiae,\n      mollitia numquam optio perspiciatis, tempora ut.</p>\n  </div>\n  <div class=\"image-container\">\n    <img [src]=\"productInfo.imageURL\" class=\"product-image\">\n  </div>\n</div>\n"]},"metadata":{},"sourceType":"module"}